"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[64],{8064:(e,n,i)=>{i.r(n),i.d(n,{default:()=>ne,formatReferrals:()=>ee});var r=i(9060),t=i(2656),o=i(4488),s=i(5448),c=i(8960),d=i(460),a=i(8526),l=i(3224),u=i(4696),m=i(2112),h=i(7256),f=i(6931),p=i(6880),v=i(5548),x=i(9e3),j=i(7824),g=i(3288),y=i(1584),b=i(5084),I=i(4380),D=i(3996),N=i(5115),w=i.n(N),C=i(3540),S=i(3055),B=i(2496);const k={readonly:!1,toolbar:!0,minHeight:250,maxHeight:250,buttons:["source","|","bold","strikethrough","underline","italic","|","ul","ol","|","outdent","indent","|","font","fontsize","paragraph","|","image","table","link","|","align","undo","redo","selectall","cut","copy","|","hr","|","print","symbol","about"],uploader:{url:"https://manage.automos.net/api/upload",imagesExtensions:["jpg","png","jpeg","gif"],withCredentials:!1,format:"json",method:"POST",prepareData:function(e){const n=Array.from(e.values()).filter((e=>e instanceof File));return Array.from(e.keys()).forEach((n=>{e.delete(n)})),n.forEach((n=>{e.append("files",n)})),e},isSuccess:function(e){return e.files.length>0},process:function(e){return{files:e.files.map((e=>e.filePath)),path:"/",baseurl:"https://manage.automos.net/api/media",error:0,msg:""}},error:function(e){console.log("Failed to upload files.")}},style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function F(e){const n=(0,r.useRef)(null),[i,t]=(0,r.useState)(""),[o,s]=(0,r.useState)(),[d,a]=(0,r.useState)(""),[l,{error:u}]=(0,C.c)(S.ef);(0,r.useEffect)((()=>{e.message&&t(e.message)}),[e.message]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(h.c,{component:"form",onSubmit:async n=>{n.preventDefault(),e.officerId?(await l({variables:{documentId:e.documentId,message:i,recipientId:d,senderId:e.officerId}}),e.onComment(),a(""),t("")):s("Not logged in.")},children:(0,B.jsxs)(c.c,{spacing:2,children:[e.recipients&&(0,B.jsx)(I.c,{name:"recipientId",select:!0,label:"Recipient",value:d,onChange:e=>a(e.target.value),required:!0,fullWidth:!0,children:e.recipients.map((e=>(0,B.jsx)(D.c,{value:e.uuid,children:e.firstName+" "+e.lastName},e.uuid)))}),(0,B.jsx)(w(),{ref:n,value:i,config:k,onChange:e=>t(e)}),(0,B.jsx)(h.c,{sx:{display:"flex",flexDirection:"row",justifyContent:"flex-end"},children:(0,B.jsx)(x.c,{type:"submit",variant:"contained",endIcon:(0,B.jsx)(b.ov,{icon:"ic:baseline-send"}),children:"Send"})})]})}),(0,B.jsx)(b.wR,{severity:"error",message:o||(null===u||void 0===u?void 0:u.message)})]})}var R=i(9036),T=i(1280),A=i(564),W=i(5888),E=i(7960),Q=i(4194);const J={readonly:!0,toolbar:!1,minHeight:250,maxHeight:250,style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function P(e){let{senderId:n,senderName:i,recipientId:t,recipientName:o,message:s}=e;const{uuid:d}=(0,Q.Cq)((e=>e.auth)),a=(0,r.useRef)(null);return(0,B.jsx)(h.c,{sx:d===n?{pl:"5%"}:{pr:"5%"},children:(0,B.jsxs)(R.c,{children:[(0,B.jsx)(T.c,{expandIcon:(0,B.jsx)(W.c,{}),"aria-controls":"panel1-content",id:"panel1-header",children:(0,B.jsxs)(c.c,{direction:"row",spacing:2,children:[(0,B.jsx)(E.c,{children:i.split(" ").map((e=>e.charAt(0))).join("")}),(0,B.jsxs)(h.c,{children:[(0,B.jsx)(p.c,{variant:"subtitle1",component:"div",children:i}),(0,B.jsx)(p.c,{variant:"body2",component:"div",children:"To ".concat(o)})]})]})}),(0,B.jsx)(A.c,{children:(0,B.jsx)(w(),{ref:a,value:s,config:J})})]})})}var U=i(3692),H=i(1096),z=i(3856),O=i(9504),q=i(700),Y=i(9904),L=i(7454),K=i(2560),M=i(4296),_=i(4480),G=i(8964);function V(e){let{role:n,officeId:i,documentId:t,receivedFrom:o,dateCreated:s,dateDue:c,referredTo:d,type:a,purpose:l,tag:u,directorAssigned:m,chiefAssigned:f}=e;const[v,x]=(0,r.useState)([]),{data:j,error:g}=(0,_.U)(G.Ej,{variables:{officeId:i?[i]:[]}}),[y,{error:I}]=(0,C.c)(S.a);return(0,r.useEffect)((()=>{n===M.QJ.Chief&&0===(null===m||void 0===m?void 0:m.length)&&f&&i&&x(f.map((e=>e.uuid)))}),[n,m,f,i]),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(U.c,{variant:"outlined",children:[(0,B.jsx)(H.c,{title:"Details"}),(0,B.jsx)(h.c,{sx:{maxHeight:{sm:"100%",md:"80vh"},overflowY:{sm:"inherit",md:"auto"}},children:(0,B.jsx)(Y.c,{children:(0,B.jsx)(z.c,{size:"small","aria-label":"dense table",children:(0,B.jsxs)(O.c,{children:[(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Type"})}),(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:a})})]}),(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Purpose"})}),(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:l})})]}),(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Tag"})}),(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:u?(0,K.SI)(u):"None"})})]}),(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Received From"})}),(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:o})})]}),(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Referred To"})}),m&&0!==m.length?(0,B.jsx)(q.c,{children:m&&m.map((e=>(0,B.jsxs)(h.c,{children:[(0,B.jsxs)(p.c,{variant:"body2",children:[e.firstName," ",e.lastName]}),(0,B.jsx)(p.c,{variant:"caption",color:"textSecondary",children:e.position||""})]},e.uuid)))}):(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:d})})]}),n===M.QJ.Chief&&0===(null===m||void 0===m?void 0:m.length)&&(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Assigned To"})}),(0,B.jsx)(q.c,{children:j&&(0,B.jsx)(b.e,{name:"assignedTo",label:"Assigned To",selected:v,required:!1,options:j.getOfficers.filter((e=>{var n;return(null===(n=e.position)||void 0===n?void 0:n.role)!==M.QJ.Chief})).map((e=>{var n;return{id:e.uuid,label:e.firstName+" "+e.lastName,description:null===(n=e.position)||void 0===n?void 0:n.label}})),onChange:e=>{x(e),t&&y({variables:{documentId:t,officerIds:e}})}})})]}),(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Date Received"})}),(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:s&&new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"})})})]}),(0,B.jsxs)(L.c,{children:[(0,B.jsx)(q.c,{component:"th",scope:"row",children:(0,B.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Date Due"})}),(0,B.jsx)(q.c,{children:(0,B.jsx)(p.c,{variant:"body2",children:c?new Date(c).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"}):"None"})})]})]})})})})]}),(0,B.jsx)(b.wR,{severity:"error",message:(null===g||void 0===g?void 0:g.message)||(null===I||void 0===I?void 0:I.message)})]})}function X(e){let{officeId:n,status:i,referenceNum:t,role:o,onUpdate:s,admin:c}=e;const{data:d,error:a}=(0,_.U)(S.SY,{fetchPolicy:"no-cache"}),[l,{error:u}]=(0,C.c)(S.wb),[m,h]=(0,r.useState)(null),[f,p]=(0,r.useState)(M.sD.Referred);(0,r.useEffect)((()=>{i&&p(i)}),[i]);const v=async(e,i)=>{var r;if(!n)return;const o=null===d||void 0===d||null===(r=d.getDocumentStatus.find((e=>e.category===i)))||void 0===r?void 0:r.id;if(!o)return void h("Status not found");(await l({variables:{officeId:n,referenceNum:t,statusId:parseInt(o)}})).data&&p(i),s()};return(0,B.jsxs)(B.Fragment,{children:[(o===M.QJ.Superuser||o===M.QJ.Director)&&(0,B.jsx)(x.c,{variant:c?"outlined":"contained",onClick:e=>v(0,f===M.sD.Finished?M.sD.Referred:M.sD.Finished),disabled:f===M.sD.NotActionable,endIcon:c?void 0:(0,B.jsx)(b.ov,{icon:"formkit:submit"}),children:f===M.sD.Finished?"Reopen":"Close"}),o===M.QJ.Chief&&(0,B.jsx)(x.c,{variant:c?"outlined":"contained",onClick:e=>v(0,f===M.sD.Submitted?M.sD.Referred:M.sD.Submitted),disabled:f===M.sD.Finished||f===M.sD.NotActionable,endIcon:c?void 0:(0,B.jsx)(b.ov,{icon:"formkit:submit"}),children:f===M.sD.Submitted?"Withdraw":"Submit"}),(0,B.jsx)(b.wR,{severity:"error",message:m||(null===a||void 0===a?void 0:a.message)||(null===u||void 0===u?void 0:u.message)})]})}var Z=i(8504);function $(e){switch(e){case M.sD.Finished:return"success";case M.sD.NotActionable:return"info";default:return"warning"}}function ee(e){return e?e.split(" ").map((e=>isNaN(parseInt(e))?e.charAt(0).toUpperCase():"-".concat(parseInt(e).toString()))).join(""):""}function ne(e){var n,i,I;let{officerId:D,officeId:N,role:w,referenceNum:C,open:k,onClose:R}=e;const T=(0,g.c)(),[A,W]=(0,r.useState)(null),{data:E,error:Q,refetch:J}=(0,_.U)(S.WK,{fetchPolicy:"no-cache",variables:{officerId:D,referenceNum:C}}),{data:U,error:H}=(0,Z.Q)(S.Cy,{fetchPolicy:"no-cache",variables:{referenceNum:C}});(0,r.useEffect)((()=>{U&&J()}),[U,J]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(t.c,{open:k,onClose:R,maxWidth:"lg",fullWidth:!0,children:(0,B.jsx)(o.c,{children:(0,B.jsxs)(s.cp,{container:!0,spacing:3,children:[(0,B.jsx)(s.cp,{item:!0,xs:12,sm:12,md:8,children:(0,B.jsxs)(c.c,{spacing:3,sx:{maxHeight:{sm:"100%",md:"80vh"},overflow:{sm:"inherit",md:"auto"},p:2},children:[(0,B.jsxs)(h.c,{children:[(0,B.jsx)(p.c,{variant:"h6",children:"#".concat(null===E||void 0===E?void 0:E.getDocumentById.referenceNum)}),(0,B.jsx)(p.c,{variant:"h3",children:null===E||void 0===E?void 0:E.getDocumentById.subject})]}),(0,B.jsx)(h.c,{children:(0,B.jsx)(p.c,{variant:"body1",children:null===E||void 0===E?void 0:E.getDocumentById.description})}),(0,B.jsxs)(c.c,{spacing:2,sx:{backgroundColor:T.palette.grey[200],p:2,borderRadius:3},children:[E&&E.getDocumentById.comments.map((e=>(0,B.jsx)(P,{senderName:[e.sender.firstName,e.sender.lastName].join(" "),senderId:e.sender.uuid,recipientName:[e.recipient.firstName,e.recipient.lastName].join(" "),recipientId:e.recipient.uuid,message:e.message},e.id))),E&&0===E.getDocumentById.comments.length&&(0,B.jsx)(p.c,{variant:"subtitle1",children:"No Comment Yet."})]}),(0,B.jsx)(m.c,{}),C&&(0,B.jsx)(F,{officerId:D,documentId:C,onComment:()=>J(),recipients:null===E||void 0===E?void 0:E.getDocumentById.recipients})]})}),(0,B.jsx)(s.cp,{item:!0,xs:12,sm:12,md:4,sx:{position:"relative"},children:(0,B.jsxs)(c.c,{spacing:3,children:[(0,B.jsxs)(c.c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,B.jsxs)(c.c,{direction:"row",alignItems:"center",spacing:2,children:[E&&![M.QJ.Superuser,M.QJ.Director].includes(w)&&(0,B.jsx)(X,{role:w,officeId:N,status:null===(n=E.getDocumentById.referredTo.find((e=>parseInt(e.office.id)===N)))||void 0===n?void 0:n.status.category,referenceNum:E.getDocumentById.referenceNum,onUpdate:()=>J()}),E&&[M.QJ.Superuser,M.QJ.Director].includes(w)&&(E.getDocumentById.referredTo.length>1?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(x.c,{onClick:e=>{W(e.currentTarget)},variant:"contained",endIcon:(0,B.jsx)(b.ov,{icon:"solar:alt-arrow-down-line-duotone"}),children:E.getDocumentById.status}),(0,B.jsx)(f.cp,{open:!!A,anchorEl:A,onClose:()=>{W(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{p:0,mt:1,ml:.75,width:500}},children:(0,B.jsx)(d.c,{children:E.getDocumentById.referredTo.map((e=>(0,B.jsxs)(a.cp,{children:[(0,B.jsx)(l.c,{primary:e.office.name,secondary:(0,B.jsx)(b.iM,{color:$(e.status.category),children:(0,K.SI)(e.status.category)})}),(0,B.jsx)(u.c,{children:(0,B.jsx)(X,{admin:!0,role:w,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:E.getDocumentById.referenceNum,onUpdate:()=>J()})})]},e.office.id)))})})]}):E.getDocumentById.referredTo.map((e=>(0,B.jsx)(X,{admin:!0,role:w,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:E.getDocumentById.referenceNum,onUpdate:()=>J()})))),(0,B.jsx)(y.gf,{document:(0,B.jsx)(b.yo,{document:E}),fileName:"".concat(C,".pdf"),children:e=>{let{url:n,loading:i}=e;return(0,B.jsx)(x.c,{onClick:()=>window.open(n,"_blank"),variant:"contained",disabled:i,endIcon:(0,B.jsx)(b.ov,{icon:"ant-design:export-outlined"}),children:"Export"})}})]}),(0,B.jsx)(v.c,{onClick:R,sx:{width:50,height:50},children:(0,B.jsx)(j.c,{})})]}),(0,B.jsx)(V,{role:w,officeId:N,documentId:null===E||void 0===E?void 0:E.getDocumentById.referenceNum,receivedFrom:null===E||void 0===E?void 0:E.getDocumentById.receivedFrom,referredTo:null===E||void 0===E?void 0:E.getDocumentById.referredTo.map((e=>e.office.name)).join(", "),type:null===E||void 0===E||null===(i=E.getDocumentById.type)||void 0===i?void 0:i.label,purpose:null===E||void 0===E||null===(I=E.getDocumentById.purpose)||void 0===I?void 0:I.map((e=>e.label)).join(", "),dateCreated:null===E||void 0===E?void 0:E.getDocumentById.dateCreated,dateDue:null===E||void 0===E?void 0:E.getDocumentById.dateDue,tag:null===E||void 0===E?void 0:E.getDocumentById.tag,directorAssigned:null===E||void 0===E?void 0:E.getDocumentById.directorAssigned.map((e=>{var n,i;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:e.position?ee(null===(n=e.office)||void 0===n?void 0:n.name)+" "+(null===(i=e.position)||void 0===i?void 0:i.label):""}})),chiefAssigned:null===E||void 0===E?void 0:E.getDocumentById.chiefAssigned.map((e=>{var n;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:null===(n=e.position)||void 0===n?void 0:n.label}}))})]})})]})})}),(0,B.jsx)(b.wR,{severity:"error",message:(null===Q||void 0===Q?void 0:Q.message)||(null===H||void 0===H?void 0:H.message)})]})}}}]);
//# sourceMappingURL=64.a3310b6d.chunk.js.map