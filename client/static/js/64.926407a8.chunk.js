"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[64],{8064:(e,n,i)=>{i.r(n),i.d(n,{default:()=>ee});var r=i(9060),t=i(2656),c=i(4488),s=i(5448),o=i(8960),d=i(460),a=i(8526),l=i(3224),u=i(4696),m=i(2112),h=i(7256),f=i(6931),x=i(6880),p=i(5548),j=i(9e3),v=i(7824),g=i(3288),y=i(1584),b=i(5084),I=i(8320),D=i(3996),w=i(5115),C=i.n(w),N=i(3540),S=i(3055),k=i(2496);const B={readonly:!1,toolbar:!0,minHeight:250,maxHeight:250,buttons:["source","|","bold","strikethrough","underline","italic","|","ul","ol","|","outdent","indent","|","font","fontsize","paragraph","|","image","table","link","|","align","undo","redo","selectall","cut","copy","|","hr","|","print","symbol","about"],uploader:{url:"https://rr6manila.com/api/upload",imagesExtensions:["jpg","png","jpeg","gif"],withCredentials:!1,format:"json",method:"POST",prepareData:function(e){const n=Array.from(e.values()).filter((e=>e instanceof File));return Array.from(e.keys()).forEach((n=>{e.delete(n)})),n.forEach((n=>{e.append("files",n)})),e},isSuccess:function(e){return e.files.length>0},process:function(e){return{files:e.files.map((e=>e.filePath)),path:"/",baseurl:"https://rr6manila.com/api/media",error:0,msg:""}},error:function(e){console.log("Failed to upload files.")}},style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function F(e){const n=(0,r.useRef)(null),[i,t]=(0,r.useState)(""),[c,s]=(0,r.useState)(),[d,a]=(0,r.useState)(""),[l,{error:u}]=(0,N.c)(S.ef);(0,r.useEffect)((()=>{e.message&&t(e.message)}),[e.message]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(h.c,{component:"form",onSubmit:async n=>{n.preventDefault(),e.officerId?(await l({variables:{documentId:e.documentId,message:i,recipientId:d,senderId:e.officerId}}),e.onComment(),a(""),t("")):s("Not logged in.")},children:(0,k.jsxs)(o.c,{spacing:2,children:[e.recipients&&(0,k.jsx)(I.c,{name:"recipientId",select:!0,label:"Recipient",value:d,onChange:e=>a(e.target.value),required:!0,fullWidth:!0,children:e.recipients.map((e=>(0,k.jsx)(D.c,{value:e.uuid,children:e.firstName+" "+e.lastName},e.uuid)))}),(0,k.jsx)(C(),{ref:n,value:i,config:B,onChange:e=>t(e)}),(0,k.jsx)(h.c,{sx:{display:"flex",flexDirection:"row",justifyContent:"flex-end"},children:(0,k.jsx)(j.c,{type:"submit",variant:"contained",endIcon:(0,k.jsx)(b.ov,{icon:"ic:baseline-send"}),children:"Send"})})]})}),(0,k.jsx)(b.wR,{severity:"error",message:c||(null===u||void 0===u?void 0:u.message)})]})}var R=i(9036),T=i(1280),W=i(564),E=i(5888),Q=i(7960),J=i(4194);const A={readonly:!0,toolbar:!1,minHeight:250,maxHeight:250,style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function P(e){let{senderId:n,senderName:i,recipientId:t,recipientName:c,message:s}=e;const{uuid:d}=(0,J.Cq)((e=>e.auth)),a=(0,r.useRef)(null);return(0,k.jsx)(h.c,{sx:d===n?{pl:"5%"}:{pr:"5%"},children:(0,k.jsxs)(R.c,{children:[(0,k.jsx)(T.c,{expandIcon:(0,k.jsx)(E.c,{}),"aria-controls":"panel1-content",id:"panel1-header",children:(0,k.jsxs)(o.c,{direction:"row",spacing:2,children:[(0,k.jsx)(Q.c,{children:i.split(" ").map((e=>e.charAt(0))).join("")}),(0,k.jsxs)(h.c,{children:[(0,k.jsx)(x.c,{variant:"subtitle1",component:"div",children:i}),(0,k.jsx)(x.c,{variant:"body2",component:"div",children:"To ".concat(c)})]})]})}),(0,k.jsx)(W.c,{children:(0,k.jsx)(C(),{ref:a,value:s,config:A})})]})})}var H=i(3692),U=i(1096),z=i(3856),O=i(9504),Y=i(700),q=i(9904),L=i(7454),M=i(2560),K=i(4296),_=i(4480),G=i(8964);function V(e){let{role:n,officeId:i,documentId:t,receivedFrom:c,dateCreated:s,dateDue:o,referredTo:d,type:a,purpose:l,tag:u,assigned:m}=e;const[f,p]=(0,r.useState)([]),{data:j,error:v}=(0,_.U)(G.Ej,{variables:{officeId:i}}),[g,{error:y}]=(0,N.c)(S.a);return(0,r.useEffect)((()=>{n===K.QJ.Chief&&m&&i&&p(m)}),[n,m,i]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(H.c,{variant:"outlined",children:[(0,k.jsx)(U.c,{title:"Details"}),(0,k.jsx)(h.c,{sx:{maxHeight:{sm:"100%",md:"80vh"},overflowY:{sm:"inherit",md:"auto"}},children:(0,k.jsx)(q.c,{children:(0,k.jsx)(z.c,{size:"small","aria-label":"dense table",children:(0,k.jsxs)(O.c,{children:[(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Received From"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:c})})]}),(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Referred To"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:d})})]}),(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Date Received"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:s&&new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"})})})]}),(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Date Due"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:o&&new Date(o).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"})})})]}),(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Document Type"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:a})})]}),(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Purpose"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:l})})]}),(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Tag"})}),(0,k.jsx)(Y.c,{children:(0,k.jsx)(x.c,{variant:"body2",children:u?(0,M.SI)(u):"None"})})]}),n===K.QJ.Chief&&(0,k.jsxs)(L.c,{children:[(0,k.jsx)(Y.c,{component:"th",scope:"row",children:(0,k.jsx)(x.c,{variant:"subtitle2",noWrap:!0,children:"Assigned"})}),(0,k.jsx)(Y.c,{children:j&&(0,k.jsx)(b.e,{name:"assignedTo",label:"Assigned To",selected:f,options:j.getOfficers.filter((e=>{var n;return(null===(n=e.position)||void 0===n?void 0:n.role)!==K.QJ.Chief})).map((e=>({id:e.uuid,label:e.firstName+" "+e.lastName}))),onChange:e=>{p(e),t&&g({variables:{documentId:t,officerIds:e}})}})})]})]})})})})]}),(0,k.jsx)(b.wR,{severity:"error",message:(null===v||void 0===v?void 0:v.message)||(null===y||void 0===y?void 0:y.message)})]})}function X(e){let{officeId:n,status:i,referenceNum:t,role:c,onUpdate:s,admin:o}=e;const{data:d,error:a}=(0,_.U)(S.SY,{fetchPolicy:"no-cache"}),[l,{error:u}]=(0,N.c)(S.wb),[m,h]=(0,r.useState)(null),[f,x]=(0,r.useState)(K.sD.Referred);(0,r.useEffect)((()=>{i&&x(i)}),[i]);const p=async(e,i)=>{var r;if(!n)return;const c=null===d||void 0===d||null===(r=d.getDocumentStatus.find((e=>e.category===i)))||void 0===r?void 0:r.id;if(!c)return void h("Status not found");(await l({variables:{officeId:n,referenceNum:t,statusId:parseInt(c)}})).data&&x(i),s()};return(0,k.jsxs)(k.Fragment,{children:[(c===K.QJ.Superuser||c===K.QJ.Director)&&(0,k.jsx)(j.c,{variant:o?"outlined":"contained",onClick:e=>p(0,f===K.sD.Finished?K.sD.Referred:K.sD.Finished),disabled:f===K.sD.NotActionable,endIcon:o?void 0:(0,k.jsx)(b.ov,{icon:"formkit:submit"}),children:f===K.sD.Finished?"Reopen":"Close"}),c===K.QJ.Chief&&(0,k.jsx)(j.c,{variant:o?"outlined":"contained",onClick:e=>p(0,f===K.sD.Submitted?K.sD.Referred:K.sD.Submitted),disabled:f===K.sD.Finished||f===K.sD.NotActionable,endIcon:o?void 0:(0,k.jsx)(b.ov,{icon:"formkit:submit"}),children:f===K.sD.Submitted?"Withdraw":"Submit"}),(0,k.jsx)(b.wR,{severity:"error",message:m||(null===a||void 0===a?void 0:a.message)||(null===u||void 0===u?void 0:u.message)})]})}var Z=i(8504);function $(e){switch(e){case K.sD.Finished:return"success";case K.sD.NotActionable:return"info";default:return"warning"}}function ee(e){var n,i,I;let{officerId:D,officeId:w,role:C,referenceNum:N,open:B,onClose:R}=e;const T=(0,g.c)(),[W,E]=(0,r.useState)(null),{data:Q,error:J,refetch:A}=(0,_.U)(S.WK,{fetchPolicy:"no-cache",variables:{officerId:D,referenceNum:N}}),{data:H,error:U}=(0,Z.Q)(S.Cy,{fetchPolicy:"no-cache",variables:{referenceNum:N}});(0,r.useEffect)((()=>{H&&A()}),[H,A]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(t.c,{open:B,onClose:R,maxWidth:"lg",fullWidth:!0,children:(0,k.jsx)(c.c,{children:(0,k.jsxs)(s.cp,{container:!0,spacing:3,children:[(0,k.jsx)(s.cp,{item:!0,xs:12,sm:12,md:8,children:(0,k.jsxs)(o.c,{spacing:3,sx:{maxHeight:{sm:"100%",md:"80vh"},overflow:{sm:"inherit",md:"auto"},p:2},children:[(0,k.jsxs)(h.c,{children:[(0,k.jsx)(x.c,{variant:"h6",children:"#".concat(null===Q||void 0===Q?void 0:Q.getDocumentById.referenceNum)}),(0,k.jsx)(x.c,{variant:"h3",children:null===Q||void 0===Q?void 0:Q.getDocumentById.subject})]}),(0,k.jsx)(h.c,{children:(0,k.jsx)(x.c,{variant:"body1",children:null===Q||void 0===Q?void 0:Q.getDocumentById.description})}),(0,k.jsx)(m.c,{children:"Messages"}),(0,k.jsxs)(o.c,{spacing:2,sx:{backgroundColor:T.palette.grey[200],p:2,borderRadius:3},children:[Q&&Q.getDocumentById.comments.map((e=>(0,k.jsx)(P,{senderName:[e.sender.firstName,e.sender.lastName].join(" "),senderId:e.sender.uuid,recipientName:[e.recipient.firstName,e.recipient.lastName].join(" "),recipientId:e.recipient.uuid,message:e.message},e.id))),Q&&0===Q.getDocumentById.comments.length&&(0,k.jsx)(x.c,{variant:"subtitle1",children:"No Comment Yet."})]}),(0,k.jsx)(m.c,{children:"Compose"}),N&&(0,k.jsx)(F,{officerId:D,documentId:N,onComment:()=>A(),recipients:null===Q||void 0===Q?void 0:Q.getDocumentById.recipients})]})}),(0,k.jsx)(s.cp,{item:!0,xs:12,sm:12,md:4,sx:{position:"relative"},children:(0,k.jsxs)(o.c,{spacing:3,children:[(0,k.jsxs)(o.c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,k.jsxs)(o.c,{direction:"row",alignItems:"center",spacing:2,children:[Q&&![K.QJ.Superuser,K.QJ.Director].includes(C)&&(0,k.jsx)(X,{role:C,officeId:w,status:null===(n=Q.getDocumentById.referredTo.find((e=>parseInt(e.office.id)===w)))||void 0===n?void 0:n.status.category,referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>A()}),Q&&[K.QJ.Superuser,K.QJ.Director].includes(C)&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(j.c,{onClick:e=>{E(e.currentTarget)},variant:"contained",endIcon:(0,k.jsx)(b.ov,{icon:"solar:alt-arrow-down-line-duotone"}),children:Q.getDocumentById.status}),(0,k.jsx)(f.cp,{open:!!W,anchorEl:W,onClose:()=>{E(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{p:0,mt:1,ml:.75,width:500}},children:(0,k.jsx)(d.c,{children:Q.getDocumentById.referredTo.map((e=>(0,k.jsxs)(a.cp,{children:[(0,k.jsx)(l.c,{primary:e.office.name,secondary:(0,k.jsx)(b.iM,{color:$(e.status.category),children:(0,M.SI)(e.status.category)})}),(0,k.jsx)(u.c,{children:(0,k.jsx)(X,{admin:!0,role:C,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>A()})})]},e.office.id)))})})]}),(0,k.jsx)(y.gf,{document:(0,k.jsx)(b.yo,{document:Q}),fileName:"".concat(N,".pdf"),children:e=>{let{url:n}=e;return n&&(0,k.jsx)(j.c,{onClick:()=>window.open(n,"_blank"),variant:"contained",endIcon:(0,k.jsx)(b.ov,{icon:"ant-design:export-outlined"}),children:"Export"})}})]}),(0,k.jsx)(p.c,{onClick:R,sx:{width:50,height:50},children:(0,k.jsx)(v.c,{})})]}),(0,k.jsx)(V,{role:C,officeId:w,documentId:null===Q||void 0===Q?void 0:Q.getDocumentById.referenceNum,receivedFrom:null===Q||void 0===Q?void 0:Q.getDocumentById.receivedFrom,referredTo:null===Q||void 0===Q?void 0:Q.getDocumentById.referredTo.map((e=>e.office.name)).join(", "),type:null===Q||void 0===Q||null===(i=Q.getDocumentById.type)||void 0===i?void 0:i.label,purpose:null===Q||void 0===Q||null===(I=Q.getDocumentById.purpose)||void 0===I?void 0:I.label,dateCreated:null===Q||void 0===Q?void 0:Q.getDocumentById.dateCreated,dateDue:null===Q||void 0===Q?void 0:Q.getDocumentById.dateDue,tag:null===Q||void 0===Q?void 0:Q.getDocumentById.tag,assigned:null===Q||void 0===Q?void 0:Q.getDocumentById.assigned.filter((e=>{var n;return(null===(n=e.position)||void 0===n?void 0:n.role)!==K.QJ.Chief})).map((e=>e.uuid))})]})})]})})}),(0,k.jsx)(b.wR,{severity:"error",message:(null===J||void 0===J?void 0:J.message)||(null===U||void 0===U?void 0:U.message)})]})}}}]);
//# sourceMappingURL=64.926407a8.chunk.js.map