"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[144],{3884:(e,n,r)=>{r.d(n,{c:()=>v});var i=r(9060),t=r(4380),o=r(3996),s=r(2892),c=r(9720),a=r(3540),l=r(3055),d=r(4296),u=r(2496);const h=[{value:d.sD.Referred,label:"Referred"},{value:d.sD.ForReview,label:"For Review"},{value:d.sD.ForRevision,label:"For Revision"},{value:d.sD.UpdateReport,label:"Update Report"},{value:d.sD.Finished,label:"Closed"}],m=[{value:d.sD.Submitted,label:"Submitted"},{value:d.sD.ForApproval,label:"For Approval"},{value:d.sD.ForReview,label:"For Review"},{value:d.sD.ForCorrection,label:"For Correction"}];function v(e){let{officeId:n,status:r,referenceNum:v,role:f,onUpdate:p,width:x=150,showLabel:j=!0}=e;const{data:g,error:b}=(0,c.UL)(l.SY,{fetchPolicy:"no-cache"}),[y,{error:I}]=(0,a.c)(l.wb),[D,w]=(0,i.useState)(null),[N,C]=(0,i.useState)(d.sD.Referred);(0,i.useEffect)((()=>{r&&C(r)}),[r]);const S=async e=>{var r;if(!n)return;const i=null===g||void 0===g||null===(r=g.getDocumentStatus.find((n=>n.category===e)))||void 0===r?void 0:r.id;if(!i)return void w("Status not found");(await y({variables:{officeId:n,referenceNum:v,statusId:parseInt(i)}})).data&&C(e),p&&p()};return(0,u.jsxs)(u.Fragment,{children:[f===d.QJ.Director&&N!==d.sD.NotActionable&&(0,u.jsx)(t.c,{name:"status",select:!0,label:j?"Status":void 0,variant:"outlined",value:N,onChange:e=>S(e.target.value),required:!0,fullWidth:!0,sx:{width:x},children:h.map((e=>(0,u.jsx)(o.c,{value:e.value,children:e.label},e.value)))}),f===d.QJ.Chief&&N!==d.sD.NotActionable&&N!==d.sD.Finished&&(0,u.jsx)(t.c,{name:"status",select:!0,label:"Status",variant:"outlined",value:N,onChange:e=>S(e.target.value),required:!0,fullWidth:!0,children:m.map((e=>(0,u.jsx)(o.c,{value:e.value,children:e.label},e.value)))}),(0,u.jsx)(s.wR,{severity:"error",message:D||(null===b||void 0===b?void 0:b.message)||(null===I||void 0===I?void 0:I.message)})]})}},7144:(e,n,r)=>{r.r(n),r.d(n,{default:()=>oe,formatReferrals:()=>te});var i=r(9060),t=r(2656),o=r(4488),s=r(5448),c=r(8960),a=r(460),l=r(8526),d=r(3224),u=r(2315),h=r(2112),m=r(7256),v=r(6931),f=r(6880),p=r(5548),x=r(9e3),j=r(7824),g=r(3288),b=r(6820),y=r(2892),I=r(272),D=r(2984),w=r(2496);function N(e){const n=e.split("_");return n[n.length-1]}function C(e){let{files:n}=e;return(0,w.jsx)(m.c,{children:n&&n.map((e=>(0,w.jsx)(a.c,{dense:!0,children:(0,w.jsxs)(l.cp,{children:[(0,w.jsx)(u.c,{children:(0,w.jsx)(D.c,{})}),e&&(0,w.jsx)(d.c,{primary:(0,w.jsx)(I.c,{href:e,target:"_blank",children:N(e)})})]})})))})}var S=r(4380),B=r(3996),F=r(5115),R=r.n(F),k=r(3540),A=r(3055);const T={readonly:!1,toolbar:!0,minHeight:250,maxHeight:250,buttons:["source","|","bold","strikethrough","underline","italic","|","ul","ol","|","outdent","indent","|","font","fontsize","paragraph","|","image","table","link","|","align","undo","redo","selectall","cut","copy","|","hr","|","print","symbol","about"],uploader:{url:"https://rr6manila.com/api/upload",imagesExtensions:["jpg","png","jpeg","gif"],withCredentials:!1,format:"json",method:"POST",prepareData:function(e){const n=Array.from(e.values()).filter((e=>e instanceof File));return Array.from(e.keys()).forEach((n=>{e.delete(n)})),n.forEach((n=>{e.append("files",n)})),e},isSuccess:function(e){return e.files.length>0},process:function(e){return{files:e.files.map((e=>e.filePath)),path:"/",baseurl:"https://rr6manila.com/api/media",error:0,msg:""}},error:function(e){console.log("Failed to upload files.")}},style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function W(e){const n=(0,i.useRef)(null),[r,t]=(0,i.useState)(""),[o,s]=(0,i.useState)(),[a,l]=(0,i.useState)(""),[d,{error:u}]=(0,k.c)(A.ef);(0,i.useEffect)((()=>{e.message&&t(e.message)}),[e.message]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(m.c,{component:"form",onSubmit:async n=>{n.preventDefault(),e.officerId?(await d({variables:{documentId:e.documentId,message:r,recipientId:a,senderId:e.officerId}}),e.onComment(),l(""),t("")):s("Not logged in.")},children:(0,w.jsxs)(c.c,{spacing:2,children:[e.recipients&&(0,w.jsx)(S.c,{name:"recipientId",select:!0,label:"Recipient",value:a,onChange:e=>l(e.target.value),required:!0,fullWidth:!0,children:e.recipients.map((e=>(0,w.jsx)(B.c,{value:e.uuid,children:e.firstName+" "+e.lastName},e.uuid)))}),(0,w.jsx)(R(),{ref:n,value:r,config:T,onChange:e=>t(e)}),(0,w.jsx)(m.c,{sx:{display:"flex",flexDirection:"row",justifyContent:"flex-end"},children:(0,w.jsx)(x.c,{type:"submit",variant:"contained",endIcon:(0,w.jsx)(y.ov,{icon:"ic:baseline-send"}),children:"Send"})})]})}),(0,w.jsx)(y.wR,{severity:"error",message:o||(null===u||void 0===u?void 0:u.message)})]})}var E=r(6392),Q=r(1280),U=r(564),J=r(5888),P=r(7960),L=r(4194);const H={readonly:!0,toolbar:!1,minHeight:250,maxHeight:250,style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function q(e){let{senderId:n,senderName:r,recipientId:t,recipientName:o,message:s}=e;const{uuid:a}=(0,L.Cq)((e=>e.auth)),l=(0,i.useRef)(null);return(0,w.jsx)(m.c,{sx:a===n?{pl:"5%"}:{pr:"5%"},children:(0,w.jsxs)(E.c,{children:[(0,w.jsx)(Q.c,{expandIcon:(0,w.jsx)(J.c,{}),"aria-controls":"panel1-content",id:"panel1-header",children:(0,w.jsxs)(c.c,{direction:"row",spacing:2,children:[(0,w.jsx)(P.c,{children:r.split(" ").map((e=>e.charAt(0))).join("")}),(0,w.jsxs)(m.c,{children:[(0,w.jsx)(f.c,{variant:"subtitle1",component:"div",children:r}),(0,w.jsx)(f.c,{variant:"body2",component:"div",children:`To ${o}`})]})]})}),(0,w.jsx)(U.c,{children:(0,w.jsx)(R(),{ref:l,value:s,config:H})})]})})}var z=r(3692),O=r(1096),$=r(3856),Y=r(9504),_=r(700),K=r(9904),M=r(7454),G=r(2560),V=r(4296),X=r(9720),Z=r(8964);function ee(e){let{role:n,officeId:r,documentId:t,receivedFrom:o,dateCreated:s,dateDue:c,referredTo:a,type:l,purpose:d,tag:u,directorAssigned:h,chiefAssigned:v}=e;const[p,x]=(0,i.useState)([]),{data:j,error:g}=(0,X.UL)(Z.Ej,{variables:{officeId:r?[r]:[]}}),[b,{error:I}]=(0,k.c)(A.a);return(0,i.useEffect)((()=>{n===V.QJ.Chief&&0===(null===h||void 0===h?void 0:h.length)&&v&&r&&x(v.map((e=>e.uuid)))}),[n,h,v,r]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(z.c,{variant:"outlined",children:[(0,w.jsx)(O.c,{title:"Details"}),(0,w.jsx)(m.c,{sx:{maxHeight:{sm:"100%",md:"80vh"},overflowY:{sm:"inherit",md:"auto"}},children:(0,w.jsx)(K.c,{children:(0,w.jsx)($.c,{size:"small","aria-label":"dense table",children:(0,w.jsxs)(Y.c,{children:[(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Type"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:l})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Purpose"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:d})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Tag"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:u?(0,G.SI)(u):"None"})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Received From"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:o})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Referred To"})}),h&&0!==h.length?(0,w.jsx)(_.c,{children:h&&h.map((e=>(0,w.jsxs)(m.c,{children:[(0,w.jsxs)(f.c,{variant:"body2",children:[e.firstName," ",e.lastName]}),(0,w.jsx)(f.c,{variant:"caption",color:"textSecondary",children:e.position||""})]},e.uuid)))}):(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:a})})]}),n===V.QJ.Chief&&0===(null===h||void 0===h?void 0:h.length)&&(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Assigned To"})}),(0,w.jsx)(_.c,{children:j&&(0,w.jsx)(y.e,{name:"assignedTo",label:"Assigned To",selected:p,required:!1,options:j.getOfficers.filter((e=>{var n;return(null===(n=e.position)||void 0===n?void 0:n.role)!==V.QJ.Chief})).map((e=>{var n;return{id:e.uuid,label:e.firstName+" "+e.lastName,description:null===(n=e.position)||void 0===n?void 0:n.label}})),onChange:e=>{x(e),t&&b({variables:{documentId:t,officerIds:e}})}})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Date Received"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:s&&new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"})})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(f.c,{variant:"subtitle2",noWrap:!0,children:"Date Due"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(f.c,{variant:"body2",children:c?new Date(c).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"}):"None"})})]})]})})})})]}),(0,w.jsx)(y.wR,{severity:"error",message:(null===g||void 0===g?void 0:g.message)||(null===I||void 0===I?void 0:I.message)})]})}var ne=r(3884),re=r(7596);function ie(e){switch(e){case V.sD.Finished:return"success";case V.sD.NotActionable:return"info";default:return"warning"}}function te(e){return e?e.split(" ").map((e=>isNaN(parseInt(e))?e.charAt(0).toUpperCase():`-${parseInt(e).toString()}`)).join(""):""}function oe(e){var n,r,I;let{officerId:D,officeId:N,role:S,referenceNum:B,open:F,onClose:R}=e;const k=(0,g.c)(),[T,E]=(0,i.useState)(null),{data:Q,error:U,refetch:J}=(0,X.UL)(A.WK,{fetchPolicy:"no-cache",variables:{officerId:D,referenceNum:B}}),{data:P,error:L}=(0,re.Q)(A.Cy,{fetchPolicy:"no-cache",variables:{referenceNum:B}});(0,i.useEffect)((()=>{P&&J()}),[P,J]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(t.c,{open:F,onClose:R,maxWidth:"lg",fullWidth:!0,children:(0,w.jsx)(o.c,{children:(0,w.jsxs)(s.cp,{container:!0,spacing:3,children:[(0,w.jsx)(s.cp,{item:!0,xs:12,sm:12,md:8,children:(0,w.jsxs)(c.c,{spacing:3,sx:{maxHeight:{sm:"100%",md:"80vh"},overflow:{sm:"inherit",md:"auto"},p:2},children:[(0,w.jsxs)(m.c,{children:[(0,w.jsx)(f.c,{variant:"h6",children:`#${null===Q||void 0===Q?void 0:Q.getDocumentById.referenceNum}`}),(0,w.jsx)(f.c,{variant:"h3",children:null===Q||void 0===Q?void 0:Q.getDocumentById.subject})]}),(0,w.jsx)(m.c,{children:(0,w.jsx)(f.c,{variant:"body1",children:null===Q||void 0===Q?void 0:Q.getDocumentById.description})}),(0,w.jsx)(C,{files:null===Q||void 0===Q?void 0:Q.getDocumentById.files}),(0,w.jsxs)(c.c,{spacing:2,sx:{backgroundColor:k.palette.grey[200],p:2,borderRadius:3},children:[Q&&Q.getDocumentById.comments.map((e=>(0,w.jsx)(q,{senderName:[e.sender.firstName,e.sender.lastName].join(" "),senderId:e.sender.uuid,recipientName:[e.recipient.firstName,e.recipient.lastName].join(" "),recipientId:e.recipient.uuid,message:e.message},e.id))),Q&&0===Q.getDocumentById.comments.length&&(0,w.jsx)(f.c,{variant:"subtitle1",children:"No Comment Yet."})]}),(0,w.jsx)(h.c,{}),B&&(0,w.jsx)(W,{officerId:D,documentId:B,onComment:()=>J(),recipients:null===Q||void 0===Q?void 0:Q.getDocumentById.recipients})]})}),(0,w.jsx)(s.cp,{item:!0,xs:12,sm:12,md:4,sx:{position:"relative"},children:(0,w.jsxs)(c.c,{spacing:3,children:[(0,w.jsxs)(c.c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,w.jsxs)(c.c,{direction:"row",alignItems:"center",spacing:2,children:[Q&&![V.QJ.Superuser,V.QJ.Director].includes(S)&&(0,w.jsx)(ne.c,{role:S,officeId:N,status:null===(n=Q.getDocumentById.referredTo.find((e=>parseInt(e.office.id)===N)))||void 0===n?void 0:n.status.category,referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>J(),showLabel:!0}),Q&&[V.QJ.Superuser,V.QJ.Director].includes(S)&&(Q.getDocumentById.referredTo.length>1?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.c,{onClick:e=>{E(e.currentTarget)},variant:"contained",endIcon:(0,w.jsx)(y.ov,{icon:"solar:alt-arrow-down-line-duotone"}),children:Q.getDocumentById.status}),(0,w.jsx)(v.cp,{open:!!T,anchorEl:T,onClose:()=>{E(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{p:0,mt:1,ml:.75,width:500}},children:(0,w.jsx)(a.c,{children:Q.getDocumentById.referredTo.map((e=>(0,w.jsxs)(l.cp,{children:[(0,w.jsx)(d.c,{primary:e.office.name,secondary:(0,w.jsx)(y.iM,{color:ie(e.status.category),children:(0,G.SI)(e.status.category)})}),(0,w.jsx)(u.c,{children:(0,w.jsx)(ne.c,{role:S,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>J()})})]},e.office.id)))})})]}):Q.getDocumentById.referredTo.map((e=>(0,w.jsx)(ne.c,{role:S,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>J()})))),(0,w.jsx)(b.gf,{document:(0,w.jsx)(y.yo,{document:Q}),fileName:`${B}.pdf`,children:e=>{let{url:n,loading:r}=e;return(0,w.jsx)(x.c,{onClick:()=>window.open(n,"_blank"),variant:"contained",disabled:r,endIcon:(0,w.jsx)(y.ov,{icon:"ant-design:export-outlined"}),children:"Export"})}})]}),(0,w.jsx)(p.c,{onClick:R,sx:{width:50,height:50},children:(0,w.jsx)(j.c,{})})]}),(0,w.jsx)(ee,{role:S,officeId:N,documentId:null===Q||void 0===Q?void 0:Q.getDocumentById.referenceNum,receivedFrom:null===Q||void 0===Q?void 0:Q.getDocumentById.receivedFrom,referredTo:null===Q||void 0===Q?void 0:Q.getDocumentById.referredTo.map((e=>e.office.name)).join(", "),type:null===Q||void 0===Q||null===(r=Q.getDocumentById.type)||void 0===r?void 0:r.label,purpose:null===Q||void 0===Q||null===(I=Q.getDocumentById.purpose)||void 0===I?void 0:I.map((e=>e.label)).join(", "),dateCreated:null===Q||void 0===Q?void 0:Q.getDocumentById.dateCreated,dateDue:null===Q||void 0===Q?void 0:Q.getDocumentById.dateDue,tag:null===Q||void 0===Q?void 0:Q.getDocumentById.tag,directorAssigned:null===Q||void 0===Q?void 0:Q.getDocumentById.directorAssigned.map((e=>{var n,r;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:e.position?te(null===(n=e.office)||void 0===n?void 0:n.name)+" "+(null===(r=e.position)||void 0===r?void 0:r.label):""}})),chiefAssigned:null===Q||void 0===Q?void 0:Q.getDocumentById.chiefAssigned.map((e=>{var n;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:null===(n=e.position)||void 0===n?void 0:n.label}}))})]})})]})})}),(0,w.jsx)(y.wR,{severity:"error",message:(null===U||void 0===U?void 0:U.message)||(null===L||void 0===L?void 0:L.message)})]})}}}]);
//# sourceMappingURL=144.47cd7c0e.chunk.js.map