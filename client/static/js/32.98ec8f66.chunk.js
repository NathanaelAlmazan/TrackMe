"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[32],{8032:(e,r,t)=>{t.r(r),t.d(r,{default:()=>V,formatReferrals:()=>L});var n=t(9060),i=t(3692),s=t(7256),c=t(3856),o=t(9504),a=t(700),l=t(7454),d=t(9904),h=t(9592),u=t(3358),f=t(6768),g=t(5548),x=t(5594),m=t(9572),j=t(8960),p=t(5084),v=t(2496);function w(e){let{filterName:r,onRefresh:t,onFilter:n,onFilterName:i}=e;return(0,v.jsxs)(f.c,{sx:{height:96,display:"flex",justifyContent:"space-between",p:e=>e.spacing(0,1,0,3)},children:[(0,v.jsx)(x.c,{value:r,onChange:i,placeholder:"Search...",startAdornment:(0,v.jsx)(m.c,{position:"start",children:(0,v.jsx)(p.ov,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})}),(0,v.jsxs)(j.c,{direction:"row",children:[(0,v.jsx)(u.c,{title:"Filter",children:(0,v.jsx)(g.c,{onClick:n,children:(0,v.jsx)(p.ov,{icon:"fluent:filter-20-filled"})})}),(0,v.jsx)(u.c,{title:"Refresh",children:(0,v.jsx)(g.c,{onClick:t,children:(0,v.jsx)(p.ov,{icon:"mdi:refresh"})})})]})]})}var b=t(8612),S=t(3248);function C(e){let{order:r,orderBy:t,headLabel:n,onRequestSort:i}=e;return(0,v.jsx)(b.c,{children:(0,v.jsx)(l.c,{children:n.map((e=>{return(0,v.jsx)(a.c,{align:e.align||"left",sortDirection:t===e.id&&r,sx:{width:e.width,minWidth:e.minWidth},children:(0,v.jsxs)(S.c,{hideSortIcon:!0,active:t===e.id,direction:t===e.id?r:"asc",onClick:(n=e.id,e=>{i(e,n)}),children:[e.label,t===e.id?(0,v.jsx)(s.c,{sx:{border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"},children:"desc"===r?"sorted descending":"sorted ascending"}):null]})},e.id);var n}))})})}var N=t(6931),y=t(3996),I=t(6880),F=t(2560);function R(e){const r=e.toLowerCase();return r.includes("ongoing")||r.includes("referred")?"warning":r.includes("finished")?"success":"info"}function k(e){let{officeId:r,document:t,onView:i,onEdit:s,onDelete:c}=e;const[o,d]=(0,n.useState)(null),[h,u]=(0,n.useState)(!1);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(l.c,{hover:!0,tabIndex:-1,role:"checkbox",children:[(0,v.jsx)(a.c,{component:"th",scope:"row",children:(0,v.jsx)(I.c,{variant:"subtitle2",noWrap:!0,children:"#".concat(t.referenceNum)})}),(0,v.jsxs)(a.c,{sx:{minWidth:250},children:[(0,v.jsx)(I.c,{variant:"body2",children:t.subject.length>255?"".concat(t.subject.slice(0,255),"..."):t.subject}),t.tag&&(0,v.jsx)(p.iM,{color:"info",children:t.tag})]}),(0,v.jsx)(a.c,{align:"right",sx:{minWidth:150},children:t.dateCreated}),(0,v.jsx)(a.c,{align:"right",children:t.receivedFrom}),(0,v.jsx)(a.c,{align:"right",sx:{maxWidth:200},children:t.referredTo}),(0,v.jsx)(a.c,{align:"right",sx:{width:50},children:(0,v.jsx)(p.iM,{color:R(t.status),children:(0,F.SI)(t.status)})}),(0,v.jsx)(a.c,{align:"right",sx:{width:30},children:(0,v.jsx)(g.c,{onClick:e=>{d(e.currentTarget)},children:(0,v.jsx)(p.ov,{icon:"eva:more-vertical-fill"})})})]}),(0,v.jsxs)(N.cp,{open:!!o,anchorEl:o,onClose:()=>{d(null)},anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[(0,v.jsxs)(y.c,{onClick:e=>{i(e,t.referenceNum),d(null)},children:[(0,v.jsx)(p.ov,{icon:"fluent-mdl2:review-solid",sx:{mr:2}}),"View"]}),void 0===r&&(0,v.jsxs)(y.c,{onClick:e=>{s(e,t.referenceNum),d(null)},children:[(0,v.jsx)(p.ov,{icon:"eva:edit-fill",sx:{mr:2}}),"Edit"]}),void 0===r&&(0,v.jsxs)(y.c,{onClick:()=>u(!0),sx:{color:"error.main"},children:[(0,v.jsx)(p.ov,{icon:"eva:trash-2-outline",sx:{mr:2}}),"Delete"]})]}),(0,v.jsx)(p._6,{open:h,onClose:()=>u(!1),onDelete:e=>{c(e,t.referenceNum),d(null),u(!1)}})]})}var P=t(4480),D=t(8504),E=t(3540),T=t(3055),W=t(8964);const A=(0,n.lazy)((()=>Promise.resolve().then(t.bind(t,9448)))),z=(0,n.lazy)((()=>Promise.resolve().then(t.bind(t,8280))));function L(e){return e.map((e=>e.split(" ").map((e=>isNaN(parseInt(e))?e.charAt(0).toUpperCase():"-".concat(parseInt(e).toString()))).join(""))).join(", ")}function O(e,r,t){return r[t]<e[t]?-1:r[t]>e[t]?1:0}function V(e){let{officerId:r,officeId:t,onRefresh:u,onView:f,onEdit:g}=e;const{data:x,error:m,refetch:j}=(0,P.U)(T.aK,{variables:{officerId:r}}),{data:p,error:b}=(0,D.Q)(W.G2),[S,N]=(0,n.useState)(!1),[y,I]=(0,n.useState)([]),[R,V]=(0,n.useState)(0),[M,q]=(0,n.useState)("asc"),[B,U]=(0,n.useState)("referenceNum"),[G,K]=(0,n.useState)(""),[Q,_]=(0,n.useState)(10),[H,J]=(0,n.useState)([]),[X,{error:Y}]=(0,E.c)(T.sT);(0,n.useEffect)((()=>{x&&J(x.getDocuments.map((e=>{var r;return{referenceNum:e.referenceNum,subject:e.subject,receivedFrom:e.receivedFrom,referredTo:e.directorAssigned.length>0?e.directorAssigned.map((e=>"".concat(e.firstName," ").concat(e.lastName))).join(", "):L(e.referredTo.map((e=>e.office.name))),dateCreated:new Date(e.dateCreated).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),status:t?"".concat((null===(r=e.referredTo.find((e=>parseInt(e.office.id)===t)))||void 0===r?void 0:r.status.category)||"REFERRED"):e.status,tag:e.tag?(0,F.SI)(e.tag):""}})))}),[x,t]),(0,n.useEffect)((()=>{p&&j()}),[p,j]);const Z=(0,n.useMemo)((()=>function(e,r){const t=e.map(((e,r)=>[e,r]));return t.sort(((e,t)=>{const n=r(e[0],t[0]);return 0!==n?n:e[1]-t[1]})),t.map((e=>e[0]))}(H.filter((e=>(e.referenceNum.includes(G)||e.subject.includes(G)||0===G.length)&&(y.includes(e.status.replace(/\d+/g,""))||y.includes(e.tag)||0===y.length))),function(e,r){return"desc"===e?(e,t)=>O(e,t,r):(e,t)=>-O(e,t,r)}(M,B)).slice(R*Q,R*Q+Q)),[H,G,M,B,R,Q,y]),$=(e,r)=>f(r),ee=(e,r)=>g(r),re=async(e,r)=>{await X({variables:{referenceNum:r}}),await j()};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(i.c,{children:[(0,v.jsx)(w,{filterName:G,onRefresh:async()=>{await j(),u()},onFilterName:e=>{V(0),K(e.target.value)},onFilter:()=>N(!S)}),(0,v.jsx)(s.c,{sx:{overflow:"auto"},children:(0,v.jsx)(d.c,{children:(0,v.jsxs)(c.c,{sx:{minWidth:900},children:[(0,v.jsx)(C,{order:M,orderBy:B,onRequestSort:(e,r)=>{q(B===r&&"asc"===M?"desc":"asc"),U(r)},headLabel:[{id:"referenceNum",label:"Reference"},{id:"subject",label:"Subject",width:250},{id:"dateCreated",label:"Date",align:"right"},{id:"receivedFrom",label:"Received From",align:"right"},{id:"referredTo",label:"Referred To",align:"right"},{id:"status",label:"Status",align:"right",width:50},{id:"tag",align:"right",width:20}]}),(0,v.jsxs)(o.c,{children:[Z.map((e=>(0,v.jsx)(k,{officeId:t,document:e,onView:$,onEdit:ee,onDelete:re},e.referenceNum))),0===Z.length&&(0,v.jsx)(l.c,{sx:{height:80},children:(0,v.jsx)(a.c,{align:"center",colSpan:6,children:"No results found."})})]})]})})}),(0,v.jsx)(h.c,{page:R,component:"div",count:H.length,rowsPerPage:Q,onPageChange:(e,r)=>{V(r)},rowsPerPageOptions:[10,25,50],onRowsPerPageChange:e=>{V(0),_(parseInt(e.target.value,10))}})]}),(0,v.jsx)(n.Suspense,{children:(0,v.jsx)(z,{open:S,selected:y,onFilter:e=>{const r=y.indexOf(e);let t=[];-1===r?t=t.concat(y,e):0===r?t=t.concat(y.slice(1)):r===y.length-1?t=t.concat(y.slice(0,-1)):r>0&&(t=t.concat(y.slice(0,r),y.slice(r+1))),I(t),V(0)},onClose:()=>N(!S),onClear:()=>I([]),filters:[{name:"Status",options:Array.from(new Set(H.map((e=>e.status)))).map((e=>({value:e,label:(0,F.SI)(e.replace(/\d+/g,""))})))},{name:"Tags",options:Array.from(new Set(H.filter((e=>e.tag)).map((e=>e.tag)))).map((e=>({value:e,label:(0,F.SI)(e)})))}]})}),(0,v.jsx)(n.Suspense,{children:(0,v.jsx)(A,{severity:"error",message:(null===m||void 0===m?void 0:m.message)||(null===b||void 0===b?void 0:b.message)||(null===Y||void 0===Y?void 0:Y.message)})})]})}}}]);
//# sourceMappingURL=32.98ec8f66.chunk.js.map