"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[156],{2156:(e,t,i)=>{i.r(t),i.d(t,{BIN_OFFICE:()=>O,default:()=>P});var n=i(9060),a=i(2656),l=i(4488),c=i(7667),s=i(9e3),r=i(5448),o=i(8960),d=i(4380),u=i(7256),p=i(6880),m=i(3996),h=i(7960),g=i(6852),v=i(8372),f=i(4996),x=i(332),j=i(4480),I=i(9732),b=i(3540),y=i(7868),D=i.n(y),N=i(5084),C=i(8964),S=i(3055),B=i(4296),T=i(2496);const w={subject:"",description:"",receivedFrom:"",typeId:"",purposeIds:"",statusId:"",signatureId:"",tag:""},O=20,F=(0,f.K)();function P(e){let{referenceNum:t,officerId:i,open:f,onClose:y}=e;const{data:P,error:W}=(0,j.U)(C.It,{fetchPolicy:"no-cache"}),{data:U,error:k}=(0,j.U)(S.yu,{fetchPolicy:"no-cache"}),{data:q,error:R}=(0,j.U)(S.SY,{fetchPolicy:"no-cache"}),{data:A,error:E}=(0,j.U)(S.oV,{fetchPolicy:"no-cache"}),{data:V,error:L}=(0,j.U)(C.g9,{fetchPolicy:"no-cache"}),{data:K,error:Y,refetch:_}=(0,j.U)(S.kl,{fetchPolicy:"no-cache"}),[z,{error:G}]=(0,I.U)(S.WK,{fetchPolicy:"no-cache"}),[H,{error:J}]=(0,I.U)(C.Ej,{fetchPolicy:"no-cache"}),[M,{error:Q}]=(0,b.c)(S.Yx),[X,{error:Z}]=(0,b.c)(S.c3),[$,ee]=(0,n.useState)([]),[te,ie]=(0,n.useState)(D()(new Date)),[ne,ae]=(0,n.useState)(!1),[le,ce]=(0,n.useState)(w),[se,re]=(0,n.useState)([]),[oe,de]=(0,n.useState)([]),{subject:ue,description:pe,receivedFrom:me,typeId:he,purposeIds:ge,statusId:ve,signatureId:fe,tag:xe}=le;(0,n.useEffect)((()=>{t?z({variables:{referenceNum:t,officerId:i}}).then((e=>{let{data:t}=e;t&&(ce({subject:t.getDocumentById.subject,description:t.getDocumentById.description,receivedFrom:t.getDocumentById.receivedFrom,typeId:t.getDocumentById.type?t.getDocumentById.type.id.toString():"",purposeIds:t.getDocumentById.purpose?t.getDocumentById.purpose.map((e=>e.id)).join(","):"",tag:t.getDocumentById.tag?t.getDocumentById.tag:"",signatureId:t.getDocumentById.signatory.uuid,statusId:""}),t.getDocumentById.dateDue&&ie(D()(new Date(t.getDocumentById.dateDue))),ee(t.getDocumentById.referredTo.map((e=>parseInt(e.office.id)))),de(t.getDocumentById.directorAssigned.map((e=>{var t,i;return{id:e.uuid,label:"".concat(e.firstName," ").concat(e.lastName),description:(null===(t=e.office)||void 0===t?void 0:t.name)+" / "+(null===(i=e.position)||void 0===i?void 0:i.label)}}))),ae(!t.getDocumentById.dateDue))})):(ce(w),ie(D()(new Date)),ee([]))}),[t,i,z]),(0,n.useEffect)((()=>{$.length>0&&H({variables:{officeId:$}}).then((e=>{let{data:t}=e;t&&re(t.getOfficers.map((e=>{var t,i;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:(null===(t=e.office)||void 0===t?void 0:t.name)+" / "+(null===(i=e.position)||void 0===i?void 0:i.label)}})))})).catch((e=>{console.error(e)}))}),[$,H]);const je=e=>{ce({...le,[e.target.name]:e.target.value})};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(a.c,{open:f,onClose:y,maxWidth:"lg",fullWidth:!0,children:(0,T.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t)await X({variables:{referenceNum:t,subject:ue,purposeIds:ge,description:pe,receivedFrom:me,typeId:parseInt(he),signatureId:fe,tag:0===xe.length?null:xe,dateDue:ne?null:te.toISOString(),assignedTo:oe.map((e=>e.id))}});else{const e=$;0===e.length&&oe.filter((e=>e.id.includes("Add"))).length>0&&e.push(O),await M({variables:{subject:ue,description:pe,purposeIds:ge,receivedFrom:me,typeId:parseInt(he),signatureId:fe,tag:0===xe.length?null:xe,referredTo:e.map((e=>({officeId:e,statusId:parseInt(ve)}))),dateDue:ne?null:te.toISOString(),assignedTo:oe.map((e=>e.id))}})}ce(w),ie(D()(new Date)),ee([]),await _(),y()},children:[(0,T.jsx)(l.c,{children:(0,T.jsxs)(r.cp,{container:!0,spacing:2,children:[(0,T.jsx)(r.cp,{item:!0,xs:12,children:K&&(0,T.jsx)(p.c,{variant:"h6",children:"#".concat(t||K.getTempReferenceNum)})}),(0,T.jsx)(r.cp,{item:!0,xs:12,sm:12,md:8,children:(0,T.jsxs)(r.cp,{container:!0,spacing:2,children:[(0,T.jsx)(r.cp,{item:!0,xs:12,children:(0,T.jsx)(d.c,{name:"subject",label:"Subject",variant:"outlined",value:ue,onChange:je,multiline:!0,rows:t?5:4,fullWidth:!0,required:!0})}),(0,T.jsx)(r.cp,{item:!0,xs:12,children:(0,T.jsx)(d.c,{name:"description",label:"Remarks",variant:"outlined",value:pe,onChange:je,multiline:!0,rows:t?4:3,fullWidth:!0})}),(0,T.jsx)(r.cp,{item:!0,xs:12,children:(0,T.jsx)(d.c,{name:"receivedFrom",label:"Received From",variant:"outlined",value:me,onChange:je,fullWidth:!0,required:!0})}),P&&!t&&(0,T.jsx)(r.cp,{item:!0,xs:12,children:(0,T.jsx)(N.e,{name:"referredTo",label:"Referred To",selected:$,required:0===oe.length,options:P.getOffices.map((e=>({id:parseInt(e.id),label:e.name}))),onChange:e=>{ee(e)}})}),!t&&(0,T.jsx)(r.cp,{item:!0,xs:12,children:(0,T.jsx)(x.c,{multiple:!0,options:se.map((e=>({id:e.uuid,label:"".concat(e.firstName," ").concat(e.lastName),description:e.position}))),value:oe,onChange:(e,t)=>{const i=t.filter((e=>e.id.includes("Add")&&!se.find((t=>t.uuid===e.id))));i.length>0&&re([...se,...i.map((e=>({uuid:e.id,firstName:e.label.split(" ",2)[0],lastName:e.label.split(" ",2)[1],position:""})))]),de(t)},getOptionKey:e=>e.id,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.id===t.id,filterOptions:(e,t)=>{const i=F(e,t);return""!==t.inputValue&&i.push({id:"Add ".concat(t.inputValue),label:'"'.concat(t.inputValue,'"'),description:""}),i},renderOption:(e,t)=>(0,T.jsx)(u.c,{component:"li",...e,children:(0,T.jsxs)(u.c,{component:"div",sx:{display:"flex",flexDirection:"column"},children:[(0,T.jsx)(p.c,{variant:"body1",children:t.label}),(0,T.jsx)(p.c,{variant:"caption",color:"textSecondary",children:t.description})]})}),renderInput:e=>(0,T.jsx)(d.c,{...e,variant:"outlined",label:"Assigned To"})})})]})}),(0,T.jsx)(r.cp,{item:!0,xs:12,sm:12,md:4,children:(0,T.jsxs)(o.c,{spacing:2,children:[A&&(0,T.jsx)(d.c,{name:"typeId",select:!0,label:"Document Type",value:he,onChange:je,variant:"outlined",required:!0,fullWidth:!0,children:A.getDocumentTypes.map((e=>(0,T.jsx)(m.c,{value:e.id,children:e.label},e.id)))}),U&&(0,T.jsx)(N.e,{name:"purposeIds",label:"Document Purpose",required:!0,selected:ge.split(",").filter((e=>""!==e)),options:U.getDocumentPurposes.map((e=>({id:e.id,label:e.label}))),onChange:e=>{ce({...le,purposeIds:e.filter((e=>""!==e)).join(",")})}}),q&&!t&&(0,T.jsx)(d.c,{name:"statusId",select:!0,label:"Document Status",value:ve,onChange:je,variant:"outlined",required:!0,fullWidth:!0,children:q.getDocumentStatus.filter((e=>e.category===B.sD.Referred||e.category===B.sD.NotActionable||t)).map((e=>(0,T.jsx)(m.c,{value:e.id,children:e.label},e.id)))}),(0,T.jsxs)(d.c,{name:"tag",select:!0,label:"Document Tag",variant:"outlined",value:xe,onChange:je,fullWidth:!0,children:[(0,T.jsx)(m.c,{value:"",children:"None"}),(0,T.jsx)(m.c,{value:"CONFIDENTIAL",children:"Confidential"}),(0,T.jsx)(m.c,{value:"TOP_PRIORITY",children:"Top Priority"}),(0,T.jsx)(m.c,{value:"FOLLOW_UP",children:"Follow Up"})]}),(0,T.jsxs)(o.c,{children:[(0,T.jsx)(N.I4,{label:"Deadline",value:te,disable:ne,onChange:e=>{e&&ie(e)}}),(0,T.jsx)(g.c,{control:(0,T.jsx)(v.c,{checked:ne,onChange:e=>{ae(e.target.checked)}}),label:"No Deadline"})]}),V&&(0,T.jsx)(d.c,{name:"signatureId",select:!0,label:"Signatory",value:fe,onChange:je,variant:"outlined",required:!0,fullWidth:!0,children:V.getSignatories.map((e=>(0,T.jsx)(m.c,{value:e.uuid,children:(0,T.jsxs)(o.c,{direction:"row",alignItems:"center",spacing:2,children:[(0,T.jsx)(h.c,{alt:e.lastName,src:e.avatar}),(0,T.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"".concat(e.firstName," ").concat(e.lastName)})]})},e.uuid)))})]})})]})}),(0,T.jsx)(c.c,{children:(0,T.jsxs)(o.c,{direction:"row",spacing:2,children:[(0,T.jsx)(s.c,{onClick:y,color:"inherit",children:"Cancel"}),(0,T.jsx)(s.c,{variant:"contained",color:"inherit",type:"submit",children:"Save"})]})})]})}),(0,T.jsx)(N.wR,{severity:"error",message:(null===W||void 0===W?void 0:W.message)||(null===k||void 0===k?void 0:k.message)||(null===Q||void 0===Q?void 0:Q.message)||(null===Z||void 0===Z?void 0:Z.message)||(null===R||void 0===R?void 0:R.message)||(null===E||void 0===E?void 0:E.message)||(null===Y||void 0===Y?void 0:Y.message)||(null===G||void 0===G?void 0:G.message)||(null===L||void 0===L?void 0:L.message)||(null===J||void 0===J?void 0:J.message)})]})}}}]);
//# sourceMappingURL=156.2754f2f7.chunk.js.map