"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[156],{2156:(e,t,i)=>{i.r(t),i.d(t,{BIN_OFFICE:()=>k,default:()=>$});var n=i(9060),a=i(2656),l=i(4488),s=i(7667),r=i(7348),o=i(8828),c=i(5448),d=i(9072),u=i(4380),p=i(9448),m=i(6880),h=i(3996),g=i(7960),f=i(6852),v=i(8372),x=i(7532),j=i(9572),I=i(3358),y=i(5548),b=i(2856),D=i(332),N=i(9780),S=i(9720),C=i(9732),w=i(3540),F=i(7868),B=i.n(F),P=i(1424),T=i(8964),O=i(3055),U=i(4296),W=i(2496);const R={subject:"",description:"",receivedFrom:"",typeId:"",purposeIds:"",statusId:"",signatureId:"",tag:""},k=20,L=(0,b.K)();function $(e){let{referenceNum:t,officerId:i,open:b,onClose:F}=e;const{data:$,error:q}=(0,S.UL)(T.It,{fetchPolicy:"no-cache"}),{data:A,error:E}=(0,S.UL)(O.yu,{fetchPolicy:"no-cache"}),{data:V,error:K}=(0,S.UL)(O.SY,{fetchPolicy:"no-cache"}),{data:Y,error:_}=(0,S.UL)(O.oV,{fetchPolicy:"no-cache"}),{data:M,error:z}=(0,S.UL)(T.g9,{fetchPolicy:"no-cache"}),{data:G,error:H,refetch:J}=(0,S.UL)(O.kl,{fetchPolicy:"no-cache"}),[Q,{error:X}]=(0,C.U)(O.WK,{fetchPolicy:"no-cache"}),[Z,{error:ee}]=(0,C.U)(T.Ej,{fetchPolicy:"no-cache"}),[te,{error:ie}]=(0,w.c)(O.Yx),[ne,{error:ae}]=(0,w.c)(O.c3),[le,se]=(0,n.useState)([]),[re,oe]=(0,n.useState)([]),[ce,de]=(0,n.useState)(B()(new Date)),[ue,pe]=(0,n.useState)(!1),[me,he]=(0,n.useState)(R),[ge,fe]=(0,n.useState)([]),[ve,xe]=(0,n.useState)(),[je,Ie]=(0,n.useState)(!1),[ye,be]=(0,n.useState)([]),{subject:De,description:Ne,receivedFrom:Se,typeId:Ce,purposeIds:we,statusId:Fe,signatureId:Be,tag:Pe}=me;(0,n.useEffect)((()=>{t?Q({variables:{referenceNum:t,officerId:i}}).then((e=>{let{data:t}=e;t&&(he({subject:t.getDocumentById.subject,description:t.getDocumentById.description,receivedFrom:t.getDocumentById.receivedFrom,typeId:t.getDocumentById.type?t.getDocumentById.type.id.toString():"",purposeIds:t.getDocumentById.purpose?t.getDocumentById.purpose.map((e=>e.id)).join(","):"",tag:t.getDocumentById.tag?t.getDocumentById.tag:"",signatureId:t.getDocumentById.signatory.uuid,statusId:""}),t.getDocumentById.dateDue&&de(B()(new Date(t.getDocumentById.dateDue))),oe(t.getDocumentById.referredTo.map((e=>parseInt(e.office.id)))),be(t.getDocumentById.directorAssigned.map((e=>{var t,i;return{id:e.uuid,label:`${e.firstName} ${e.lastName}`,description:(null===(t=e.office)||void 0===t?void 0:t.name)+" / "+(null===(i=e.position)||void 0===i?void 0:i.label)}}))),pe(!t.getDocumentById.dateDue))})):(he(R),de(B()(new Date)),oe([]))}),[t,i,Q]),(0,n.useEffect)((()=>{re.length>0&&Z({variables:{officeId:re}}).then((e=>{let{data:t}=e;t&&fe(t.getOfficers.map((e=>{var t,i;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:(null===(t=e.office)||void 0===t?void 0:t.name)+" / "+(null===(i=e.position)||void 0===i?void 0:i.label)}})))})).catch((e=>{console.log(e)}))}),[re,Z]);const Te=e=>{he({...me,[e.target.name]:e.target.value})};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(a.c,{open:b,onClose:F,maxWidth:"lg",fullWidth:!0,children:(0,W.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),Ie(!0);let i=[];if(le.length>0)try{const e=new FormData;le.forEach((t=>{e.append("files",t)}));i=(await N.c.post("https://rr6manila.com/api/upload",e)).data.files}catch(n){return void xe("Faled to upload files. Please make sure that files are less than 80MB.")}if(t)await ne({variables:{referenceNum:t,subject:De,purposeIds:we,description:Ne,receivedFrom:Se,typeId:parseInt(Ce),signatureId:Be,tag:0===Pe.length?null:Pe,dateDue:ue?null:ce.toISOString(),assignedTo:ye.map((e=>e.id)),files:i.length>0?i.map((e=>e.fileUrl)).join(";"):null}});else{const e=re;0===e.length&&ye.filter((e=>e.id.includes("Add"))).length>0&&e.push(k),await te({variables:{subject:De,description:Ne,purposeIds:we,receivedFrom:Se,typeId:parseInt(Ce),signatureId:Be,tag:0===Pe.length?null:Pe,referredTo:e.map((e=>({officeId:e,statusId:parseInt(Fe)}))),dateDue:ue?null:ce.toISOString(),assignedTo:ye.map((e=>e.id)),files:i.length>0?i.map((e=>e.fileUrl)).join(";"):null}})}he(R),de(B()(new Date)),oe([]),Ie(!1),await J(),F()},children:[(0,W.jsx)(l.c,{children:(0,W.jsxs)(c.cp,{container:!0,spacing:2,children:[(0,W.jsx)(c.cp,{item:!0,xs:12,children:G&&(0,W.jsx)(m.c,{variant:"h6",children:`#${t||G.getTempReferenceNum}`})}),(0,W.jsx)(c.cp,{item:!0,xs:12,sm:12,md:8,children:(0,W.jsxs)(c.cp,{container:!0,spacing:2,children:[(0,W.jsx)(c.cp,{item:!0,xs:12,children:(0,W.jsx)(u.c,{name:"subject",label:"Subject",variant:"outlined",value:De,onChange:Te,multiline:!0,rows:t?5:4,fullWidth:!0,required:!0})}),(0,W.jsxs)(c.cp,{item:!0,xs:12,children:[(0,W.jsx)(u.c,{label:"Remarks",name:"description",variant:"outlined",value:Ne,onChange:Te,multiline:!0,rows:t?4:3,fullWidth:!0,InputProps:{endAdornment:(0,W.jsx)(j.c,{position:"end",children:(0,W.jsx)(I.c,{title:"Insert File",children:(0,W.jsxs)(y.c,{component:"label",children:[(0,W.jsx)(P.ov,{icon:"material-symbols:attach-file-add-rounded"}),(0,W.jsx)("input",{type:"file",multiple:!0,hidden:!0,onChange:e=>{const t=e.target.files;t&&se((e=>e.concat(function(e){const t=[];for(let i=0;i<e.length;i++){const n=e.item(i);n&&t.push(n)}return t}(t))))}})]})})})}}),(0,W.jsx)(p.c,{sx:{pt:1,maxWidth:"100%",overflow:"auto",display:"flex",flexDirection:"row"},children:le.map((e=>(0,W.jsx)(x.c,{label:e.name,variant:"outlined",onDelete:()=>{return t=e.name,void se((e=>e.filter((e=>e.name!==t))));var t},sx:{mx:"5px"}},e.name)))})]}),(0,W.jsx)(c.cp,{item:!0,xs:12,children:(0,W.jsx)(u.c,{name:"receivedFrom",label:"Received From",variant:"outlined",value:Se,onChange:Te,fullWidth:!0,required:!0})}),$&&!t&&(0,W.jsx)(c.cp,{item:!0,xs:12,children:(0,W.jsx)(P.e,{name:"referredTo",label:"Referred To",selected:re,required:0===ye.length,options:$.getOffices.map((e=>({id:parseInt(e.id),label:e.name}))),onChange:e=>{oe(e)}})}),!t&&(0,W.jsx)(c.cp,{item:!0,xs:12,children:(0,W.jsx)(D.c,{multiple:!0,options:ge.map((e=>({id:e.uuid,label:`${e.firstName} ${e.lastName}`,description:e.position}))),value:ye,onChange:(e,t)=>{const i=t.filter((e=>e.id.includes("Add")&&!ge.find((t=>t.uuid===e.id))));i.length>0&&fe([...ge,...i.map((e=>({uuid:e.id,firstName:e.label.split(" ",2)[0],lastName:e.label.split(" ",2)[1],position:""})))]),be(t)},getOptionKey:e=>e.id,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.id===t.id,filterOptions:(e,t)=>{const i=L(e,t);return""!==t.inputValue&&i.push({id:`Add ${t.inputValue}`,label:`"${t.inputValue}"`,description:""}),i},renderOption:(e,t)=>(0,W.jsx)(p.c,{component:"li",...e,children:(0,W.jsxs)(p.c,{component:"div",sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(m.c,{variant:"body1",children:t.label}),(0,W.jsx)(m.c,{variant:"caption",color:"textSecondary",children:t.description})]})}),renderInput:e=>(0,W.jsx)(u.c,{...e,variant:"outlined",label:"Assigned To"})})})]})}),(0,W.jsx)(c.cp,{item:!0,xs:12,sm:12,md:4,children:(0,W.jsxs)(d.c,{spacing:2,children:[Y&&(0,W.jsx)(u.c,{name:"typeId",select:!0,label:"Document Type",value:Ce,onChange:Te,variant:"outlined",required:!0,fullWidth:!0,children:Y.getDocumentTypes.map((e=>(0,W.jsx)(h.c,{value:e.id,children:e.label},e.id)))}),A&&(0,W.jsx)(P.e,{name:"purposeIds",label:"Document Purpose",required:!0,selected:we.split(",").filter((e=>""!==e)),options:A.getDocumentPurposes.map((e=>({id:e.id,label:e.label}))),onChange:e=>{he({...me,purposeIds:e.filter((e=>""!==e)).join(",")})}}),V&&!t&&(0,W.jsx)(u.c,{name:"statusId",select:!0,label:"Document Status",value:Fe,onChange:Te,variant:"outlined",required:!0,fullWidth:!0,children:V.getDocumentStatus.filter((e=>e.category===U.sD.Referred||e.category===U.sD.NotActionable||e.category===U.sD.ForReview||e.category===U.sD.ForRevision||e.category===U.sD.UpdateReport||t)).map((e=>(0,W.jsx)(h.c,{value:e.id,children:e.label},e.id)))}),(0,W.jsxs)(u.c,{name:"tag",select:!0,label:"Document Tag",variant:"outlined",value:Pe,onChange:Te,fullWidth:!0,children:[(0,W.jsx)(h.c,{value:"",children:"None"}),(0,W.jsx)(h.c,{value:"CONFIDENTIAL",children:"Confidential"}),(0,W.jsx)(h.c,{value:"TOP_PRIORITY",children:"Top Priority"}),(0,W.jsx)(h.c,{value:"FOLLOW_UP",children:"Follow Up"})]}),(0,W.jsxs)(d.c,{children:[(0,W.jsx)(P.I4,{label:"Deadline",value:ce,disable:ue,onChange:e=>{e&&de(e)}}),(0,W.jsx)(f.c,{control:(0,W.jsx)(v.c,{checked:ue,onChange:e=>{pe(e.target.checked)}}),label:"No Deadline"})]}),M&&(0,W.jsx)(u.c,{name:"signatureId",select:!0,label:"Signatory",value:Be,onChange:Te,variant:"outlined",required:!0,fullWidth:!0,children:M.getSignatories.map((e=>(0,W.jsx)(h.c,{value:e.uuid,children:(0,W.jsxs)(d.c,{direction:"row",alignItems:"center",spacing:2,children:[(0,W.jsx)(g.c,{alt:e.lastName,src:e.avatar}),(0,W.jsx)(m.c,{variant:"subtitle2",noWrap:!0,children:`${e.firstName} ${e.lastName}`})]})},e.uuid)))})]})})]})}),(0,W.jsx)(s.c,{children:(0,W.jsxs)(d.c,{direction:"row",spacing:2,children:[(0,W.jsx)(r.c,{onClick:F,color:"inherit",children:"Cancel"}),(0,W.jsx)(o.c,{loading:je,variant:"contained",color:"inherit",type:"submit",children:"Save"})]})})]})}),(0,W.jsx)(P.wR,{severity:"error",message:ve||(null===q||void 0===q?void 0:q.message)||(null===E||void 0===E?void 0:E.message)||(null===ie||void 0===ie?void 0:ie.message)||(null===ae||void 0===ae?void 0:ae.message)||(null===K||void 0===K?void 0:K.message)||(null===_||void 0===_?void 0:_.message)||(null===H||void 0===H?void 0:H.message)||(null===X||void 0===X?void 0:X.message)||(null===z||void 0===z?void 0:z.message)||(null===ee||void 0===ee?void 0:ee.message)})]})}}}]);
//# sourceMappingURL=156.47a28eac.chunk.js.map