"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[156],{2156:(e,t,i)=>{i.r(t),i.d(t,{BIN_OFFICE:()=>R,default:()=>k});var n=i(9060),a=i(2656),l=i(4488),r=i(7667),s=i(9e3),o=i(5448),c=i(8960),d=i(4380),u=i(7256),p=i(6880),m=i(3996),h=i(7960),g=i(6852),f=i(8372),v=i(7532),x=i(9572),j=i(3358),I=i(5548),y=i(2856),b=i(332),D=i(9780),N=i(9720),C=i(9732),S=i(3540),w=i(7868),F=i.n(w),B=i(2892),T=i(8964),O=i(3055),P=i(4296),U=i(2496);const W={subject:"",description:"",receivedFrom:"",typeId:"",purposeIds:"",statusId:"",signatureId:"",tag:""},R=20,L=(0,y.K)();function k(e){let{referenceNum:t,officerId:i,open:y,onClose:w}=e;const{data:k,error:$}=(0,N.UL)(T.It,{fetchPolicy:"no-cache"}),{data:q,error:A}=(0,N.UL)(O.yu,{fetchPolicy:"no-cache"}),{data:E,error:V}=(0,N.UL)(O.SY,{fetchPolicy:"no-cache"}),{data:K,error:Y}=(0,N.UL)(O.oV,{fetchPolicy:"no-cache"}),{data:_,error:z}=(0,N.UL)(T.g9,{fetchPolicy:"no-cache"}),{data:G,error:H,refetch:J}=(0,N.UL)(O.kl,{fetchPolicy:"no-cache"}),[M,{error:Q}]=(0,C.U)(O.WK,{fetchPolicy:"no-cache"}),[X,{error:Z}]=(0,C.U)(T.Ej,{fetchPolicy:"no-cache"}),[ee,{error:te}]=(0,S.c)(O.Yx),[ie,{error:ne}]=(0,S.c)(O.c3),[ae,le]=(0,n.useState)([]),[re,se]=(0,n.useState)([]),[oe,ce]=(0,n.useState)(F()(new Date)),[de,ue]=(0,n.useState)(!1),[pe,me]=(0,n.useState)(W),[he,ge]=(0,n.useState)([]),[fe,ve]=(0,n.useState)([]),{subject:xe,description:je,receivedFrom:Ie,typeId:ye,purposeIds:be,statusId:De,signatureId:Ne,tag:Ce}=pe;(0,n.useEffect)((()=>{t?M({variables:{referenceNum:t,officerId:i}}).then((e=>{let{data:t}=e;t&&(me({subject:t.getDocumentById.subject,description:t.getDocumentById.description,receivedFrom:t.getDocumentById.receivedFrom,typeId:t.getDocumentById.type?t.getDocumentById.type.id.toString():"",purposeIds:t.getDocumentById.purpose?t.getDocumentById.purpose.map((e=>e.id)).join(","):"",tag:t.getDocumentById.tag?t.getDocumentById.tag:"",signatureId:t.getDocumentById.signatory.uuid,statusId:""}),t.getDocumentById.dateDue&&ce(F()(new Date(t.getDocumentById.dateDue))),se(t.getDocumentById.referredTo.map((e=>parseInt(e.office.id)))),ve(t.getDocumentById.directorAssigned.map((e=>{var t,i;return{id:e.uuid,label:`${e.firstName} ${e.lastName}`,description:(null===(t=e.office)||void 0===t?void 0:t.name)+" / "+(null===(i=e.position)||void 0===i?void 0:i.label)}}))),ue(!t.getDocumentById.dateDue))})):(me(W),ce(F()(new Date)),se([]))}),[t,i,M]),(0,n.useEffect)((()=>{re.length>0&&X({variables:{officeId:re}}).then((e=>{let{data:t}=e;t&&ge(t.getOfficers.map((e=>{var t,i;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:(null===(t=e.office)||void 0===t?void 0:t.name)+" / "+(null===(i=e.position)||void 0===i?void 0:i.label)}})))})).catch((e=>{console.error(e)}))}),[re,X]);const Se=e=>{me({...pe,[e.target.name]:e.target.value})};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(a.c,{open:y,onClose:w,maxWidth:"lg",fullWidth:!0,children:(0,U.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let i=[];if(ae.length>0)try{const e=new FormData;ae.forEach((t=>{e.append("files",t)}));i=(await D.c.post("https://rr6manila.com/api/upload",e)).data.files}catch(n){return}if(t)await ie({variables:{referenceNum:t,subject:xe,purposeIds:be,description:je,receivedFrom:Ie,typeId:parseInt(ye),signatureId:Ne,tag:0===Ce.length?null:Ce,dateDue:de?null:oe.toISOString(),assignedTo:fe.map((e=>e.id)),files:i.length>0?i.map((e=>e.fileUrl)).join(";"):null}});else{const e=re;0===e.length&&fe.filter((e=>e.id.includes("Add"))).length>0&&e.push(R),await ee({variables:{subject:xe,description:je,purposeIds:be,receivedFrom:Ie,typeId:parseInt(ye),signatureId:Ne,tag:0===Ce.length?null:Ce,referredTo:e.map((e=>({officeId:e,statusId:parseInt(De)}))),dateDue:de?null:oe.toISOString(),assignedTo:fe.map((e=>e.id)),files:i.length>0?i.map((e=>e.fileUrl)).join(";"):null}})}me(W),ce(F()(new Date)),se([]),await J(),w()},children:[(0,U.jsx)(l.c,{children:(0,U.jsxs)(o.cp,{container:!0,spacing:2,children:[(0,U.jsx)(o.cp,{item:!0,xs:12,children:G&&(0,U.jsx)(p.c,{variant:"h6",children:`#${t||G.getTempReferenceNum}`})}),(0,U.jsx)(o.cp,{item:!0,xs:12,sm:12,md:8,children:(0,U.jsxs)(o.cp,{container:!0,spacing:2,children:[(0,U.jsx)(o.cp,{item:!0,xs:12,children:(0,U.jsx)(d.c,{name:"subject",label:"Subject",variant:"outlined",value:xe,onChange:Se,multiline:!0,rows:t?5:4,fullWidth:!0,required:!0})}),(0,U.jsxs)(o.cp,{item:!0,xs:12,children:[(0,U.jsx)(d.c,{label:"Remarks",name:"description",variant:"outlined",value:je,onChange:Se,multiline:!0,rows:t?4:3,fullWidth:!0,InputProps:{endAdornment:(0,U.jsx)(x.c,{position:"end",children:(0,U.jsx)(j.c,{title:"Insert File",children:(0,U.jsxs)(I.c,{component:"label",children:[(0,U.jsx)(B.ov,{icon:"material-symbols:attach-file-add-rounded"}),(0,U.jsx)("input",{type:"file",multiple:!0,hidden:!0,onChange:e=>{const t=e.target.files;t&&le((e=>e.concat(function(e){const t=[];for(let i=0;i<e.length;i++){const n=e.item(i);n&&t.push(n)}return t}(t))))}})]})})})}}),(0,U.jsx)(u.c,{sx:{pt:1,maxWidth:"100%",overflow:"auto",display:"flex",flexDirection:"row"},children:ae.map((e=>(0,U.jsx)(v.c,{label:e.name,variant:"outlined",onDelete:()=>{return t=e.name,void le((e=>e.filter((e=>e.name!==t))));var t},sx:{mx:"5px"}},e.name)))})]}),(0,U.jsx)(o.cp,{item:!0,xs:12,children:(0,U.jsx)(d.c,{name:"receivedFrom",label:"Received From",variant:"outlined",value:Ie,onChange:Se,fullWidth:!0,required:!0})}),k&&!t&&(0,U.jsx)(o.cp,{item:!0,xs:12,children:(0,U.jsx)(B.e,{name:"referredTo",label:"Referred To",selected:re,required:0===fe.length,options:k.getOffices.map((e=>({id:parseInt(e.id),label:e.name}))),onChange:e=>{se(e)}})}),!t&&(0,U.jsx)(o.cp,{item:!0,xs:12,children:(0,U.jsx)(b.c,{multiple:!0,options:he.map((e=>({id:e.uuid,label:`${e.firstName} ${e.lastName}`,description:e.position}))),value:fe,onChange:(e,t)=>{const i=t.filter((e=>e.id.includes("Add")&&!he.find((t=>t.uuid===e.id))));i.length>0&&ge([...he,...i.map((e=>({uuid:e.id,firstName:e.label.split(" ",2)[0],lastName:e.label.split(" ",2)[1],position:""})))]),ve(t)},getOptionKey:e=>e.id,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.id===t.id,filterOptions:(e,t)=>{const i=L(e,t);return""!==t.inputValue&&i.push({id:`Add ${t.inputValue}`,label:`"${t.inputValue}"`,description:""}),i},renderOption:(e,t)=>(0,U.jsx)(u.c,{component:"li",...e,children:(0,U.jsxs)(u.c,{component:"div",sx:{display:"flex",flexDirection:"column"},children:[(0,U.jsx)(p.c,{variant:"body1",children:t.label}),(0,U.jsx)(p.c,{variant:"caption",color:"textSecondary",children:t.description})]})}),renderInput:e=>(0,U.jsx)(d.c,{...e,variant:"outlined",label:"Assigned To"})})})]})}),(0,U.jsx)(o.cp,{item:!0,xs:12,sm:12,md:4,children:(0,U.jsxs)(c.c,{spacing:2,children:[K&&(0,U.jsx)(d.c,{name:"typeId",select:!0,label:"Document Type",value:ye,onChange:Se,variant:"outlined",required:!0,fullWidth:!0,children:K.getDocumentTypes.map((e=>(0,U.jsx)(m.c,{value:e.id,children:e.label},e.id)))}),q&&(0,U.jsx)(B.e,{name:"purposeIds",label:"Document Purpose",required:!0,selected:be.split(",").filter((e=>""!==e)),options:q.getDocumentPurposes.map((e=>({id:e.id,label:e.label}))),onChange:e=>{me({...pe,purposeIds:e.filter((e=>""!==e)).join(",")})}}),E&&!t&&(0,U.jsx)(d.c,{name:"statusId",select:!0,label:"Document Status",value:De,onChange:Se,variant:"outlined",required:!0,fullWidth:!0,children:E.getDocumentStatus.filter((e=>e.category===P.sD.Referred||e.category===P.sD.NotActionable||e.category===P.sD.ForReview||e.category===P.sD.ForRevision||e.category===P.sD.UpdateReport||t)).map((e=>(0,U.jsx)(m.c,{value:e.id,children:e.label},e.id)))}),(0,U.jsxs)(d.c,{name:"tag",select:!0,label:"Document Tag",variant:"outlined",value:Ce,onChange:Se,fullWidth:!0,children:[(0,U.jsx)(m.c,{value:"",children:"None"}),(0,U.jsx)(m.c,{value:"CONFIDENTIAL",children:"Confidential"}),(0,U.jsx)(m.c,{value:"TOP_PRIORITY",children:"Top Priority"}),(0,U.jsx)(m.c,{value:"FOLLOW_UP",children:"Follow Up"})]}),(0,U.jsxs)(c.c,{children:[(0,U.jsx)(B.I4,{label:"Deadline",value:oe,disable:de,onChange:e=>{e&&ce(e)}}),(0,U.jsx)(g.c,{control:(0,U.jsx)(f.c,{checked:de,onChange:e=>{ue(e.target.checked)}}),label:"No Deadline"})]}),_&&(0,U.jsx)(d.c,{name:"signatureId",select:!0,label:"Signatory",value:Ne,onChange:Se,variant:"outlined",required:!0,fullWidth:!0,children:_.getSignatories.map((e=>(0,U.jsx)(m.c,{value:e.uuid,children:(0,U.jsxs)(c.c,{direction:"row",alignItems:"center",spacing:2,children:[(0,U.jsx)(h.c,{alt:e.lastName,src:e.avatar}),(0,U.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:`${e.firstName} ${e.lastName}`})]})},e.uuid)))})]})})]})}),(0,U.jsx)(r.c,{children:(0,U.jsxs)(c.c,{direction:"row",spacing:2,children:[(0,U.jsx)(s.c,{onClick:w,color:"inherit",children:"Cancel"}),(0,U.jsx)(s.c,{variant:"contained",color:"inherit",type:"submit",children:"Save"})]})})]})}),(0,U.jsx)(B.wR,{severity:"error",message:(null===$||void 0===$?void 0:$.message)||(null===A||void 0===A?void 0:A.message)||(null===te||void 0===te?void 0:te.message)||(null===ne||void 0===ne?void 0:ne.message)||(null===V||void 0===V?void 0:V.message)||(null===Y||void 0===Y?void 0:Y.message)||(null===H||void 0===H?void 0:H.message)||(null===Q||void 0===Q?void 0:Q.message)||(null===z||void 0===z?void 0:z.message)||(null===Z||void 0===Z?void 0:Z.message)})]})}}}]);
//# sourceMappingURL=156.7636283a.chunk.js.map