"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[144],{3884:(e,r,n)=>{n.d(r,{c:()=>v});var i=n(9060),t=n(4380),o=n(3996),s=n(2892),c=n(9720),a=n(3540),l=n(3055),d=n(4296),u=n(2496);const h=[{value:d.sD.Referred,label:"Referred"},{value:d.sD.ForReview,label:"For Review"},{value:d.sD.ForRevision,label:"For Revision"},{value:d.sD.ForCorrection,label:"For Correction"},{value:d.sD.ForApproval,label:"For Approval"},{value:d.sD.UpdateReport,label:"Update Report"},{value:d.sD.Finished,label:"Closed"}],m=[{value:d.sD.Submitted,label:"Submitted"},{value:d.sD.ForApproval,label:"For Approval"},{value:d.sD.ForReview,label:"For Review"},{value:d.sD.ForCorrection,label:"For Correction"}];function v(e){let{officeId:r,status:n,referenceNum:v,role:p,onUpdate:f,width:x=150,showLabel:j=!0}=e;const{data:g,error:b}=(0,c.UL)(l.SY,{fetchPolicy:"no-cache"}),[y,{error:I}]=(0,a.c)(l.wb),[D,w]=(0,i.useState)(null),[N,C]=(0,i.useState)(d.sD.Referred);(0,i.useEffect)((()=>{n&&C(n)}),[n]);const F=async e=>{var n;if(!r)return;const i=null===g||void 0===g||null===(n=g.getDocumentStatus.find((r=>r.category===e)))||void 0===n?void 0:n.id;if(!i)return void w("Status not found");(await y({variables:{officeId:r,referenceNum:v,statusId:parseInt(i)}})).data&&C(e),f&&f()};return(0,u.jsxs)(u.Fragment,{children:[p===d.QJ.Director&&N!==d.sD.NotActionable&&(0,u.jsx)(t.c,{name:"status",select:!0,label:j?"Status":void 0,variant:"outlined",value:N,onChange:e=>F(e.target.value),required:!0,fullWidth:!0,sx:{width:x},children:h.map((e=>(0,u.jsx)(o.c,{value:e.value,children:e.label},e.value)))}),p===d.QJ.Chief&&N!==d.sD.NotActionable&&N!==d.sD.Finished&&(0,u.jsx)(t.c,{name:"status",select:!0,label:"Status",variant:"outlined",value:N,onChange:e=>F(e.target.value),required:!0,fullWidth:!0,children:m.map((e=>(0,u.jsx)(o.c,{value:e.value,children:e.label},e.value)))}),(0,u.jsx)(s.wR,{severity:"error",message:D||(null===b||void 0===b?void 0:b.message)||(null===I||void 0===I?void 0:I.message)})]})}},7144:(e,r,n)=>{n.r(r),n.d(r,{default:()=>oe,formatReferrals:()=>te});var i=n(9060),t=n(2656),o=n(4488),s=n(5448),c=n(8960),a=n(460),l=n(8526),d=n(3224),u=n(2315),h=n(2112),m=n(7256),v=n(6931),p=n(6880),f=n(5548),x=n(9e3),j=n(7824),g=n(3288),b=n(6820),y=n(2892),I=n(272),D=n(2984),w=n(2496);function N(e){const r=e.split("_");return r[r.length-1]}function C(e){let{files:r}=e;return(0,w.jsx)(m.c,{children:r&&r.map((e=>(0,w.jsx)(a.c,{dense:!0,children:(0,w.jsxs)(l.cp,{children:[(0,w.jsx)(u.c,{children:(0,w.jsx)(D.c,{})}),e&&(0,w.jsx)(d.c,{primary:(0,w.jsx)(I.c,{href:e,target:"_blank",children:N(e)})})]})})))})}var F=n(4380),S=n(3996),B=n(5115),R=n.n(B),A=n(3540),k=n(3055);const T={readonly:!1,toolbar:!0,minHeight:250,maxHeight:250,buttons:["source","|","bold","strikethrough","underline","italic","|","ul","ol","|","outdent","indent","|","font","fontsize","paragraph","|","image","table","link","|","align","undo","redo","selectall","cut","copy","|","hr","|","print","symbol","about"],uploader:{url:"https://rr6manila.com/api/upload",imagesExtensions:["jpg","png","jpeg","gif"],withCredentials:!1,format:"json",method:"POST",prepareData:function(e){const r=Array.from(e.values()).filter((e=>e instanceof File));return Array.from(e.keys()).forEach((r=>{e.delete(r)})),r.forEach((r=>{e.append("files",r)})),e},isSuccess:function(e){return e.files.length>0},process:function(e){return{files:e.files.map((e=>e.filePath)),path:"/",baseurl:"https://rr6manila.com/api/media",error:0,msg:""}},error:function(e){console.log("Failed to upload files.")}},style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function W(e){const r=(0,i.useRef)(null),[n,t]=(0,i.useState)(""),[o,s]=(0,i.useState)(),[a,l]=(0,i.useState)(""),[d,{error:u}]=(0,A.c)(k.ef);(0,i.useEffect)((()=>{e.message&&t(e.message)}),[e.message]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(m.c,{component:"form",onSubmit:async r=>{r.preventDefault(),e.officerId?(await d({variables:{documentId:e.documentId,message:n,recipientId:a,senderId:e.officerId}}),e.onComment(),l(""),t("")):s("Not logged in.")},children:(0,w.jsxs)(c.c,{spacing:2,children:[e.recipients&&(0,w.jsx)(F.c,{name:"recipientId",select:!0,label:"Recipient",value:a,onChange:e=>l(e.target.value),required:!0,fullWidth:!0,children:e.recipients.map((e=>(0,w.jsx)(S.c,{value:e.uuid,children:e.firstName+" "+e.lastName},e.uuid)))}),(0,w.jsx)(R(),{ref:r,value:n,config:T,onChange:e=>t(e)}),(0,w.jsx)(m.c,{sx:{display:"flex",flexDirection:"row",justifyContent:"flex-end"},children:(0,w.jsx)(x.c,{type:"submit",variant:"contained",endIcon:(0,w.jsx)(y.ov,{icon:"ic:baseline-send"}),children:"Send"})})]})}),(0,w.jsx)(y.wR,{severity:"error",message:o||(null===u||void 0===u?void 0:u.message)})]})}var E=n(6392),Q=n(1280),U=n(564),J=n(5888),P=n(7960),L=n(4194);const H={readonly:!0,toolbar:!1,minHeight:250,maxHeight:250,style:{"& .jodit .jodit-status-bar":{background:"#29572E",color:"rgba(255,255,255,0.5)"}}};function q(e){let{senderId:r,senderName:n,recipientId:t,recipientName:o,message:s}=e;const{uuid:a}=(0,L.Cq)((e=>e.auth)),l=(0,i.useRef)(null);return(0,w.jsx)(m.c,{sx:a===r?{pl:"5%"}:{pr:"5%"},children:(0,w.jsxs)(E.c,{children:[(0,w.jsx)(Q.c,{expandIcon:(0,w.jsx)(J.c,{}),"aria-controls":"panel1-content",id:"panel1-header",children:(0,w.jsxs)(c.c,{direction:"row",spacing:2,children:[(0,w.jsx)(P.c,{children:n.split(" ").map((e=>e.charAt(0))).join("")}),(0,w.jsxs)(m.c,{children:[(0,w.jsx)(p.c,{variant:"subtitle1",component:"div",children:n}),(0,w.jsx)(p.c,{variant:"body2",component:"div",children:`To ${o}`})]})]})}),(0,w.jsx)(U.c,{children:(0,w.jsx)(R(),{ref:l,value:s,config:H})})]})})}var z=n(3692),O=n(1096),$=n(3856),Y=n(9504),_=n(700),K=n(9904),M=n(7454),G=n(2560),V=n(4296),X=n(9720),Z=n(8964);function ee(e){let{role:r,officeId:n,documentId:t,receivedFrom:o,dateCreated:s,dateDue:c,referredTo:a,type:l,purpose:d,tag:u,directorAssigned:h,chiefAssigned:v}=e;const[f,x]=(0,i.useState)([]),{data:j,error:g}=(0,X.UL)(Z.Ej,{variables:{officeId:n?[n]:[]}}),[b,{error:I}]=(0,A.c)(k.a);return(0,i.useEffect)((()=>{r===V.QJ.Chief&&0===(null===h||void 0===h?void 0:h.length)&&v&&n&&x(v.map((e=>e.uuid)))}),[r,h,v,n]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(z.c,{variant:"outlined",children:[(0,w.jsx)(O.c,{title:"Details"}),(0,w.jsx)(m.c,{sx:{maxHeight:{sm:"100%",md:"80vh"},overflowY:{sm:"inherit",md:"auto"}},children:(0,w.jsx)(K.c,{children:(0,w.jsx)($.c,{size:"small","aria-label":"dense table",children:(0,w.jsxs)(Y.c,{children:[(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Type"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:l})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Purpose"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:d})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Tag"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:u?(0,G.SI)(u):"None"})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Received From"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:o})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Referred To"})}),h&&0!==h.length?(0,w.jsx)(_.c,{children:h&&h.map((e=>(0,w.jsxs)(m.c,{children:[(0,w.jsxs)(p.c,{variant:"body2",children:[e.firstName," ",e.lastName]}),(0,w.jsx)(p.c,{variant:"caption",color:"textSecondary",children:e.position||""})]},e.uuid)))}):(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:a})})]}),r===V.QJ.Chief&&0===(null===h||void 0===h?void 0:h.length)&&(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Assigned To"})}),(0,w.jsx)(_.c,{children:j&&(0,w.jsx)(y.e,{name:"assignedTo",label:"Assigned To",selected:f,required:!1,options:j.getOfficers.filter((e=>{var r;return(null===(r=e.position)||void 0===r?void 0:r.role)!==V.QJ.Chief})).map((e=>{var r;return{id:e.uuid,label:e.firstName+" "+e.lastName,description:null===(r=e.position)||void 0===r?void 0:r.label}})),onChange:e=>{x(e),t&&b({variables:{documentId:t,officerIds:e}})}})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Date Received"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:s&&new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"})})})]}),(0,w.jsxs)(M.c,{children:[(0,w.jsx)(_.c,{component:"th",scope:"row",children:(0,w.jsx)(p.c,{variant:"subtitle2",noWrap:!0,children:"Date Due"})}),(0,w.jsx)(_.c,{children:(0,w.jsx)(p.c,{variant:"body2",children:c?new Date(c).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"}):"None"})})]})]})})})})]}),(0,w.jsx)(y.wR,{severity:"error",message:(null===g||void 0===g?void 0:g.message)||(null===I||void 0===I?void 0:I.message)})]})}var re=n(3884),ne=n(7596);function ie(e){switch(e){case V.sD.Finished:return"success";case V.sD.NotActionable:return"info";default:return"warning"}}function te(e){return e?e.split(" ").map((e=>isNaN(parseInt(e))?e.charAt(0).toUpperCase():`-${parseInt(e).toString()}`)).join(""):""}function oe(e){var r,n,I;let{officerId:D,officeId:N,role:F,referenceNum:S,open:B,onClose:R}=e;const A=(0,g.c)(),[T,E]=(0,i.useState)(null),{data:Q,error:U,refetch:J}=(0,X.UL)(k.WK,{fetchPolicy:"no-cache",variables:{officerId:D,referenceNum:S}}),{data:P,error:L}=(0,ne.Q)(k.Cy,{fetchPolicy:"no-cache",variables:{referenceNum:S}});(0,i.useEffect)((()=>{P&&J()}),[P,J]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(t.c,{open:B,onClose:R,maxWidth:"lg",fullWidth:!0,children:(0,w.jsx)(o.c,{children:(0,w.jsxs)(s.cp,{container:!0,spacing:3,children:[(0,w.jsx)(s.cp,{item:!0,xs:12,sm:12,md:8,children:(0,w.jsxs)(c.c,{spacing:3,sx:{maxHeight:{sm:"100%",md:"80vh"},overflow:{sm:"inherit",md:"auto"},p:2},children:[(0,w.jsxs)(m.c,{children:[(0,w.jsx)(p.c,{variant:"h6",children:`#${null===Q||void 0===Q?void 0:Q.getDocumentById.referenceNum}`}),(0,w.jsx)(p.c,{variant:"h3",children:null===Q||void 0===Q?void 0:Q.getDocumentById.subject})]}),(0,w.jsx)(m.c,{children:(0,w.jsx)(p.c,{variant:"body1",children:null===Q||void 0===Q?void 0:Q.getDocumentById.description})}),(0,w.jsx)(C,{files:null===Q||void 0===Q?void 0:Q.getDocumentById.files}),(0,w.jsxs)(c.c,{spacing:2,sx:{backgroundColor:A.palette.grey[200],p:2,borderRadius:3},children:[Q&&Q.getDocumentById.comments.map((e=>(0,w.jsx)(q,{senderName:[e.sender.firstName,e.sender.lastName].join(" "),senderId:e.sender.uuid,recipientName:[e.recipient.firstName,e.recipient.lastName].join(" "),recipientId:e.recipient.uuid,message:e.message},e.id))),Q&&0===Q.getDocumentById.comments.length&&(0,w.jsx)(p.c,{variant:"subtitle1",children:"No Comment Yet."})]}),(0,w.jsx)(h.c,{}),S&&(0,w.jsx)(W,{officerId:D,documentId:S,onComment:()=>J(),recipients:null===Q||void 0===Q?void 0:Q.getDocumentById.recipients})]})}),(0,w.jsx)(s.cp,{item:!0,xs:12,sm:12,md:4,sx:{position:"relative"},children:(0,w.jsxs)(c.c,{spacing:3,children:[(0,w.jsxs)(c.c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,w.jsxs)(c.c,{direction:"row",alignItems:"center",spacing:2,children:[Q&&![V.QJ.Superuser,V.QJ.Director].includes(F)&&(0,w.jsx)(re.c,{role:F,officeId:N,status:null===(r=Q.getDocumentById.referredTo.find((e=>parseInt(e.office.id)===N)))||void 0===r?void 0:r.status.category,referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>J(),showLabel:!0}),Q&&[V.QJ.Superuser,V.QJ.Director].includes(F)&&(Q.getDocumentById.referredTo.length>1?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.c,{onClick:e=>{E(e.currentTarget)},variant:"contained",endIcon:(0,w.jsx)(y.ov,{icon:"solar:alt-arrow-down-line-duotone"}),children:Q.getDocumentById.status}),(0,w.jsx)(v.cp,{open:!!T,anchorEl:T,onClose:()=>{E(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{p:0,mt:1,ml:.75,width:500}},children:(0,w.jsx)(a.c,{children:Q.getDocumentById.referredTo.map((e=>(0,w.jsxs)(l.cp,{children:[(0,w.jsx)(d.c,{primary:e.office.name,secondary:(0,w.jsx)(y.iM,{color:ie(e.status.category),children:(0,G.SI)(e.status.category)})}),(0,w.jsx)(u.c,{children:(0,w.jsx)(re.c,{role:F,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>J()})})]},e.office.id)))})})]}):Q.getDocumentById.referredTo.map((e=>(0,w.jsx)(re.c,{role:F,status:e.status.category,officeId:parseInt(e.office.id),referenceNum:Q.getDocumentById.referenceNum,onUpdate:()=>J()})))),(0,w.jsx)(b.gf,{document:(0,w.jsx)(y.yo,{document:Q}),fileName:`${S}.pdf`,children:e=>{let{url:r,loading:n}=e;return(0,w.jsx)(x.c,{onClick:()=>window.open(r,"_blank"),variant:"contained",disabled:n,endIcon:(0,w.jsx)(y.ov,{icon:"ant-design:export-outlined"}),children:"Export"})}})]}),(0,w.jsx)(f.c,{onClick:R,sx:{width:50,height:50},children:(0,w.jsx)(j.c,{})})]}),(0,w.jsx)(ee,{role:F,officeId:N,documentId:null===Q||void 0===Q?void 0:Q.getDocumentById.referenceNum,receivedFrom:null===Q||void 0===Q?void 0:Q.getDocumentById.receivedFrom,referredTo:null===Q||void 0===Q?void 0:Q.getDocumentById.referredTo.map((e=>e.office.name)).join(", "),type:null===Q||void 0===Q||null===(n=Q.getDocumentById.type)||void 0===n?void 0:n.label,purpose:null===Q||void 0===Q||null===(I=Q.getDocumentById.purpose)||void 0===I?void 0:I.map((e=>e.label)).join(", "),dateCreated:null===Q||void 0===Q?void 0:Q.getDocumentById.dateCreated,dateDue:null===Q||void 0===Q?void 0:Q.getDocumentById.dateDue,tag:null===Q||void 0===Q?void 0:Q.getDocumentById.tag,directorAssigned:null===Q||void 0===Q?void 0:Q.getDocumentById.directorAssigned.map((e=>{var r,n;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:e.position?te(null===(r=e.office)||void 0===r?void 0:r.name)+" "+(null===(n=e.position)||void 0===n?void 0:n.label):""}})),chiefAssigned:null===Q||void 0===Q?void 0:Q.getDocumentById.chiefAssigned.map((e=>{var r;return{uuid:e.uuid,firstName:e.firstName,lastName:e.lastName,position:null===(r=e.position)||void 0===r?void 0:r.label}}))})]})})]})})}),(0,w.jsx)(y.wR,{severity:"error",message:(null===U||void 0===U?void 0:U.message)||(null===L||void 0===L?void 0:L.message)})]})}}}]);
//# sourceMappingURL=144.ccf0cfcc.chunk.js.map